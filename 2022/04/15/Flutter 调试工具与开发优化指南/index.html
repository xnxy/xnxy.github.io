<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"xnxy.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.15.0","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Flutter 调试工具与开发优化指南。">
<meta property="og:type" content="article">
<meta property="og:title" content="Flutter 调试工具与开发优化指南">
<meta property="og:url" content="https://xnxy.github.io/2022/04/15/Flutter%20%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B8%8E%E5%BC%80%E5%8F%91%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="拿根针尖对麦芒">
<meta property="og:description" content="Flutter 调试工具与开发优化指南。">
<meta property="og:locale">
<meta property="article:published_time" content="2022-04-14T16:00:00.000Z">
<meta property="article:modified_time" content="2022-06-12T16:00:00.000Z">
<meta property="article:author" content="拿根针尖对麦芒">
<meta property="article:tag" content="Flutter">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://xnxy.github.io/2022/04/15/Flutter%20%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B8%8E%E5%BC%80%E5%8F%91%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-Hans","comments":true,"permalink":"https://xnxy.github.io/2022/04/15/Flutter%20%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B8%8E%E5%BC%80%E5%8F%91%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/","path":"2022/04/15/Flutter 调试工具与开发优化指南/","title":"Flutter 调试工具与开发优化指南"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Flutter 调试工具与开发优化指南 | 拿根针尖对麦芒</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">拿根针尖对麦芒</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">拿根针尖对麦芒</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Flutter-%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B8%8E%E5%BC%80%E5%8F%91%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97"><span class="nav-number">1.</span> <span class="nav-text">Flutter 调试工具与开发优化指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Flutter-%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E8%AF%A6%E8%A7%A3"><span class="nav-number">1.2.</span> <span class="nav-text">Flutter 调试工具详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-debugPaintSizeEnabled-%E5%B8%83%E5%B1%80%E8%BE%B9%E7%95%8C%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">1.2.1.</span> <span class="nav-text">1. debugPaintSizeEnabled - 布局边界可视化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">功能说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">使用方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%88%87%E6%8D%A2"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">运行时切换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.2.1.4.</span> <span class="nav-text">使用场景</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-debugRepaintRainbowEnabled-%E9%87%8D%E7%BB%98%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">1.2.2.</span> <span class="nav-text">2. debugRepaintRainbowEnabled - 重绘可视化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E-1"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">功能说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F-1"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">使用方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95%EF%BC%9A%E6%9D%A1%E4%BB%B6%E5%90%AF%E7%94%A8"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">高级用法：条件启用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">性能分析示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="nav-number">1.2.3.</span> <span class="nav-text">3. 其他重要调试工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#debugPaintLayerBordersEnabled-%E5%9B%BE%E5%B1%82%E8%BE%B9%E7%95%8C%E6%98%BE%E7%A4%BA"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">debugPaintLayerBordersEnabled - 图层边界显示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#debugProfileBuildsEnabled-%E6%9E%84%E5%BB%BA%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">debugProfileBuildsEnabled - 构建性能分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">组合使用调试工具</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.2.4.</span> <span class="nav-text">4. 调试工具最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%88%99"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">使用原则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E6%B5%81%E7%A8%8B%E5%BB%BA%E8%AE%AE"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">调试流程建议</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.3.</span> <span class="nav-text">开发技巧与最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Widget-%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96"><span class="nav-number">1.3.1.</span> <span class="nav-text">1. Widget 构建优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E5%9C%A8-build-%E6%96%B9%E6%B3%95%E4%B8%AD%E5%88%9B%E5%BB%BA-Widget"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">避免在 build 方法中创建 Widget</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-const-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">使用 const 构造函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E4%BC%98%E5%8C%96"><span class="nav-number">1.3.2.</span> <span class="nav-text">2. 状态管理优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B2%BE%E7%A1%AE%E6%8E%A7%E5%88%B6-setState-%E8%8C%83%E5%9B%B4"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">精确控制 setState 范围</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%88%97%E8%A1%A8%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">1.3.3.</span> <span class="nav-text">3. 列表性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-ListView-builder-%E5%A4%84%E7%90%86%E5%A4%A7%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">使用 ListView.builder 处理大数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">实现懒加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-AutomaticKeepAliveClientMixin"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">使用 AutomaticKeepAliveClientMixin</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96"><span class="nav-number">1.3.4.</span> <span class="nav-text">2. 图片优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%98%E4%BC%98%E5%8C%96"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">网络图片缓存优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E9%A2%84%E5%8A%A0%E8%BD%BD%E7%AD%96%E7%95%A5"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">图片预加载策略</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E5%B0%BA%E5%AF%B8%E4%BC%98%E5%8C%96"><span class="nav-number">1.3.4.3.</span> <span class="nav-text">图片尺寸优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD"><span class="nav-number">1.3.4.4.</span> <span class="nav-text">响应式图片加载</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%8A%A8%E7%94%BB%E4%BC%98%E5%8C%96"><span class="nav-number">1.3.5.</span> <span class="nav-text">3. 动画优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-AnimatedBuilder-%E4%BC%98%E5%8C%96%E5%8A%A8%E7%94%BB%E6%80%A7%E8%83%BD"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">使用 AnimatedBuilder 优化动画性能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AB%98%E6%80%A7%E8%83%BD%E5%88%97%E8%A1%A8%E5%8A%A8%E7%94%BB"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">高性能列表动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB%E4%BC%98%E5%8C%96"><span class="nav-number">1.3.5.3.</span> <span class="nav-text">页面转场动画优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E7%94%BB%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7"><span class="nav-number">1.3.5.4.</span> <span class="nav-text">动画性能监控</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="nav-number">1.4.</span> <span class="nav-text">项目优化建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84%E4%BC%98%E5%8C%96"><span class="nav-number">1.4.1.</span> <span class="nav-text">1. 代码结构优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%89%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E7%BB%84%E7%BB%87%E4%BB%A3%E7%A0%81"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">按功能模块组织代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">使用依赖注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Clean-Architecture-%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">Clean Architecture 实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-number">1.4.2.</span> <span class="nav-text">2. 内存管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A3%E7%A1%AE%E5%A4%84%E7%90%86%E8%B5%84%E6%BA%90%E9%87%8A%E6%94%BE"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">正确处理资源释放</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A3%80%E6%B5%8B%E5%92%8C%E9%A2%84%E9%98%B2"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">内存泄漏检测和预防</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9B%86%E5%90%88%E4%BC%98%E5%8C%96"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">大数据集合优化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%BC%98%E5%8C%96"><span class="nav-number">1.4.3.</span> <span class="nav-text">3. 网络请求优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E8%AF%B7%E6%B1%82%E7%BC%93%E5%AD%98%E5%92%8C%E9%87%8D%E8%AF%95%E6%9C%BA%E5%88%B6"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">实现请求缓存和重试机制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96"><span class="nav-number">1.4.4.</span> <span class="nav-text">4. 构建优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-build-gradle-%E4%BC%98%E5%8C%96%E7%BC%96%E8%AF%91%E9%80%9F%E5%BA%A6"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">配置 build.gradle 优化编译速度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Flutter-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">使用 Flutter 性能分析工具</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%B5%8B%E8%AF%95%E7%AD%96%E7%95%A5"><span class="nav-number">1.4.5.</span> <span class="nav-text">5. 测试策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%85%A8%E9%9D%A2%E7%9A%84%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">实现全面的测试覆盖</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.5.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%8F%82%E8%80%83"><span class="nav-number">1.5.1.</span> <span class="nav-text">快速参考</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%BF%AB%E9%80%9F%E5%90%AF%E7%94%A8"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">调试工具快速启用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">性能优化检查清单</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="拿根针尖对麦芒"
      src="http://blog-zhouwei.oss-cn-beijing.aliyuncs.com/head.jpeg">
  <p class="site-author-name" itemprop="name">拿根针尖对麦芒</p>
  <div class="site-description" itemprop="description">修行ing</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">85</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/xnxy" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xnxy" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/xnxyonly1" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;xnxyonly1" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://jewsaten.github.io/" title="https:&#x2F;&#x2F;jewsaten.github.io" rel="noopener" target="_blank">「蒋·先生」</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://guyueyang.github.io/" title="https:&#x2F;&#x2F;guyueyang.github.io" rel="noopener" target="_blank">晓平</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xnxy.github.io/2022/04/15/Flutter%20%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B8%8E%E5%BC%80%E5%8F%91%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://blog-zhouwei.oss-cn-beijing.aliyuncs.com/head.jpeg">
      <meta itemprop="name" content="拿根针尖对麦芒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="拿根针尖对麦芒">
      <meta itemprop="description" content="修行ing">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Flutter 调试工具与开发优化指南 | 拿根针尖对麦芒">
      <meta itemprop="description" content="Flutter 调试工具与开发优化指南。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Flutter 调试工具与开发优化指南
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-04-15 00:00:00" itemprop="dateCreated datePublished" datetime="2022-04-15T00:00:00+08:00">2022-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-06-13 00:00:00" itemprop="dateModified" datetime="2022-06-13T00:00:00+08:00">2022-06-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Flutter/" itemprop="url" rel="index"><span itemprop="name">Flutter</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">Flutter 调试工具与开发优化指南。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Flutter-调试工具与开发优化指南"><a href="#Flutter-调试工具与开发优化指南" class="headerlink" title="Flutter 调试工具与开发优化指南"></a>Flutter 调试工具与开发优化指南</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><a href="#flutter-%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E8%AF%A6%E8%A7%A3">Flutter 调试工具详解</a></li>
<li><a href="#%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">开发技巧与最佳实践</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">性能优化策略</a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE">项目优化建议</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">总结</a></li>
</ol>
<hr>
<h2 id="Flutter-调试工具详解"><a href="#Flutter-调试工具详解" class="headerlink" title="Flutter 调试工具详解"></a>Flutter 调试工具详解</h2><h3 id="1-debugPaintSizeEnabled-布局边界可视化"><a href="#1-debugPaintSizeEnabled-布局边界可视化" class="headerlink" title="1. debugPaintSizeEnabled - 布局边界可视化"></a>1. debugPaintSizeEnabled - 布局边界可视化</h3><h4 id="功能说明"><a href="#功能说明" class="headerlink" title="功能说明"></a>功能说明</h4><p><code>debugPaintSizeEnabled</code> 是 Flutter 提供的调试工具，用于显示所有 Widget 的布局边界。启用后，每个 Widget 都会显示一个彩色边框，帮助开发者理解布局结构和调试布局问题。</p>
<h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/rendering.dart&#x27;</span>; <span class="comment">// 导入渲染库</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/foundation.dart&#x27;</span>; <span class="comment">// 导入基础库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="comment">// 只在调试模式下启用，避免影响生产环境性能</span></span><br><span class="line">  <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">    debugPaintSizeEnabled = <span class="keyword">true</span>; <span class="comment">// 启用布局边界显示</span></span><br><span class="line">  &#125;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="运行时切换"><a href="#运行时切换" class="headerlink" title="运行时切换"></a>运行时切换</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在应用运行时动态切换</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DebugToggleWidget</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _DebugToggleWidgetState createState() =&gt; _DebugToggleWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_DebugToggleWidgetState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">DebugToggleWidget</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> FloatingActionButton(</span><br><span class="line">      onPressed: () &#123;</span><br><span class="line">        setState(() &#123;</span><br><span class="line">          <span class="comment">// 切换布局边界显示状态</span></span><br><span class="line">          debugPaintSizeEnabled = !debugPaintSizeEnabled;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      child: Icon(debugPaintSizeEnabled ? Icons.visibility_off : Icons.visibility),</span><br><span class="line">      tooltip: debugPaintSizeEnabled ? <span class="string">&#x27;隐藏布局边界&#x27;</span> : <span class="string">&#x27;显示布局边界&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li><strong>布局调试</strong>：查看 Widget 的实际占用空间</li>
<li><strong>对齐问题</strong>：检查元素是否正确对齐</li>
<li><strong>间距调试</strong>：验证 padding 和 margin 设置</li>
<li><strong>嵌套分析</strong>：理解复杂的 Widget 嵌套结构</li>
</ul>
<h3 id="2-debugRepaintRainbowEnabled-重绘可视化"><a href="#2-debugRepaintRainbowEnabled-重绘可视化" class="headerlink" title="2. debugRepaintRainbowEnabled - 重绘可视化"></a>2. debugRepaintRainbowEnabled - 重绘可视化</h3><h4 id="功能说明-1"><a href="#功能说明-1" class="headerlink" title="功能说明"></a>功能说明</h4><p><code>debugRepaintRainbowEnabled</code> 用于显示 Widget 的重绘情况。启用后，每次 Widget 重绘时都会显示不同颜色的边框，颜色会随着重绘次数变化，帮助识别不必要的重绘操作。</p>
<h4 id="使用方式-1"><a href="#使用方式-1" class="headerlink" title="使用方式"></a>使用方式</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/rendering.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/foundation.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">    debugRepaintRainbowEnabled = <span class="keyword">true</span>; <span class="comment">// 启用重绘彩虹显示</span></span><br><span class="line">    <span class="comment">// 注意：不要同时启用 debugPaintSizeEnabled，会影响观察效果</span></span><br><span class="line">    <span class="comment">// debugPaintSizeEnabled = false;</span></span><br><span class="line">  &#125;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="高级用法：条件启用"><a href="#高级用法：条件启用" class="headerlink" title="高级用法：条件启用"></a>高级用法：条件启用</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceDebugApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: <span class="keyword">const</span> Text(<span class="string">&#x27;性能调试&#x27;</span>),</span><br><span class="line">          actions: [</span><br><span class="line">            <span class="comment">// 添加调试工具切换按钮</span></span><br><span class="line">            IconButton(</span><br><span class="line">              icon: <span class="keyword">const</span> Icon(Icons.bug_report),</span><br><span class="line">              onPressed: () &#123;</span><br><span class="line">                <span class="comment">// 切换重绘彩虹显示</span></span><br><span class="line">                debugRepaintRainbowEnabled = !debugRepaintRainbowEnabled;</span><br><span class="line">                <span class="comment">// 强制重建以应用更改</span></span><br><span class="line">                (context <span class="keyword">as</span> <span class="built_in">Element</span>).markNeedsBuild();</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">        body: <span class="keyword">const</span> PerformanceTestWidget(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="性能分析示例"><a href="#性能分析示例" class="headerlink" title="性能分析示例"></a>性能分析示例</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 演示如何使用重绘彩虹分析性能问题</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RepaintAnalysisWidget</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _RepaintAnalysisWidgetState createState() =&gt; _RepaintAnalysisWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_RepaintAnalysisWidgetState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">RepaintAnalysisWidget</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: [</span><br><span class="line">        <span class="comment">// 这个 Text 会频繁重绘（不好的做法）</span></span><br><span class="line">        Text(<span class="string">&#x27;计数器: <span class="subst">$_counter</span>&#x27;</span>),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 RepaintBoundary 隔离重绘区域（好的做法）</span></span><br><span class="line">        RepaintBoundary(</span><br><span class="line">          child: CounterDisplay(counter: _counter),</span><br><span class="line">        ),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 静态内容，不应该重绘</span></span><br><span class="line">        <span class="keyword">const</span> RepaintBoundary(</span><br><span class="line">          child: Text(<span class="string">&#x27;这是静态内容，不应该重绘&#x27;</span>),</span><br><span class="line">        ),</span><br><span class="line">        </span><br><span class="line">        ElevatedButton(</span><br><span class="line">          onPressed: () &#123;</span><br><span class="line">            setState(() &#123;</span><br><span class="line">              _counter++; <span class="comment">// 只更新必要的状态</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">          child: <span class="keyword">const</span> Text(<span class="string">&#x27;增加计数&#x27;</span>),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 独立的计数器显示组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterDisplay</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> counter;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> CounterDisplay(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.counter&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// 这个组件只在 counter 变化时重建</span></span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16</span>),</span><br><span class="line">      decoration: BoxDecoration(</span><br><span class="line">        border: Border.all(color: Colors.blue),</span><br><span class="line">        borderRadius: BorderRadius.circular(<span class="number">8</span>),</span><br><span class="line">      ),</span><br><span class="line">      child: Text(</span><br><span class="line">        <span class="string">&#x27;当前计数: <span class="subst">$counter</span>&#x27;</span>,</span><br><span class="line">        style: <span class="keyword">const</span> TextStyle(fontSize: <span class="number">24</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-其他重要调试工具"><a href="#3-其他重要调试工具" class="headerlink" title="3. 其他重要调试工具"></a>3. 其他重要调试工具</h3><h4 id="debugPaintLayerBordersEnabled-图层边界显示"><a href="#debugPaintLayerBordersEnabled-图层边界显示" class="headerlink" title="debugPaintLayerBordersEnabled - 图层边界显示"></a>debugPaintLayerBordersEnabled - 图层边界显示</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">    debugPaintLayerBordersEnabled = <span class="keyword">true</span>; <span class="comment">// 显示渲染图层边界</span></span><br><span class="line">  &#125;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="debugProfileBuildsEnabled-构建性能分析"><a href="#debugProfileBuildsEnabled-构建性能分析" class="headerlink" title="debugProfileBuildsEnabled - 构建性能分析"></a>debugProfileBuildsEnabled - 构建性能分析</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">    debugProfileBuildsEnabled = <span class="keyword">true</span>; <span class="comment">// 启用构建性能分析</span></span><br><span class="line">  &#125;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="组合使用调试工具"><a href="#组合使用调试工具" class="headerlink" title="组合使用调试工具"></a>组合使用调试工具</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建调试工具管理类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DebugToolsManager</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">bool</span> _isEnabled = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 切换所有调试工具</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> toggleDebugTools() &#123;</span><br><span class="line">    _isEnabled = !_isEnabled;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">      debugPaintSizeEnabled = _isEnabled;</span><br><span class="line">      debugRepaintRainbowEnabled = <span class="keyword">false</span>; <span class="comment">// 避免同时启用</span></span><br><span class="line">      debugPaintLayerBordersEnabled = _isEnabled;</span><br><span class="line">      debugProfileBuildsEnabled = _isEnabled;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 只启用重绘分析</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> enableRepaintAnalysis() &#123;</span><br><span class="line">    <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">      debugPaintSizeEnabled = <span class="keyword">false</span>;</span><br><span class="line">      debugRepaintRainbowEnabled = <span class="keyword">true</span>;</span><br><span class="line">      debugPaintLayerBordersEnabled = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 只启用布局分析</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> enableLayoutAnalysis() &#123;</span><br><span class="line">    <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">      debugPaintSizeEnabled = <span class="keyword">true</span>;</span><br><span class="line">      debugRepaintRainbowEnabled = <span class="keyword">false</span>;</span><br><span class="line">      debugPaintLayerBordersEnabled = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-调试工具最佳实践"><a href="#4-调试工具最佳实践" class="headerlink" title="4. 调试工具最佳实践"></a>4. 调试工具最佳实践</h3><h4 id="使用原则"><a href="#使用原则" class="headerlink" title="使用原则"></a>使用原则</h4><ol>
<li><strong>分阶段使用</strong>：不要同时启用所有调试工具</li>
<li><strong>针对性分析</strong>：根据具体问题选择合适的工具</li>
<li><strong>生产环境禁用</strong>：确保调试工具不会影响发布版本</li>
<li><strong>结合 DevTools</strong>：配合 Flutter DevTools 进行深度分析</li>
</ol>
<h4 id="调试流程建议"><a href="#调试流程建议" class="headerlink" title="调试流程建议"></a>调试流程建议</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 推荐的调试流程</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DebugWorkflow</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 第一步：布局问题诊断</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> step1_layoutDebugging() &#123;</span><br><span class="line">    <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">      debugPaintSizeEnabled = <span class="keyword">true</span>;</span><br><span class="line">      debugRepaintRainbowEnabled = <span class="keyword">false</span>;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;步骤1: 启用布局边界显示，检查布局问题&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 第二步：性能问题诊断</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> step2_performanceDebugging() &#123;</span><br><span class="line">    <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">      debugPaintSizeEnabled = <span class="keyword">false</span>;</span><br><span class="line">      debugRepaintRainbowEnabled = <span class="keyword">true</span>;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;步骤2: 启用重绘彩虹，分析性能问题&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 第三步：图层问题诊断</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> step3_layerDebugging() &#123;</span><br><span class="line">    <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">      debugPaintSizeEnabled = <span class="keyword">false</span>;</span><br><span class="line">      debugRepaintRainbowEnabled = <span class="keyword">false</span>;</span><br><span class="line">      debugPaintLayerBordersEnabled = <span class="keyword">true</span>;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;步骤3: 启用图层边界，检查渲染层次&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 关闭所有调试工具</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> disableAllDebugging() &#123;</span><br><span class="line">    <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">      debugPaintSizeEnabled = <span class="keyword">false</span>;</span><br><span class="line">      debugRepaintRainbowEnabled = <span class="keyword">false</span>;</span><br><span class="line">      debugPaintLayerBordersEnabled = <span class="keyword">false</span>;</span><br><span class="line">      debugProfileBuildsEnabled = <span class="keyword">false</span>;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;调试完成: 已关闭所有调试工具&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="开发技巧与最佳实践"><a href="#开发技巧与最佳实践" class="headerlink" title="开发技巧与最佳实践"></a>开发技巧与最佳实践</h2><h3 id="1-Widget-构建优化"><a href="#1-Widget-构建优化" class="headerlink" title="1. Widget 构建优化"></a>1. Widget 构建优化</h3><h4 id="避免在-build-方法中创建-Widget"><a href="#避免在-build-方法中创建-Widget" class="headerlink" title="避免在 build 方法中创建 Widget"></a>避免在 build 方法中创建 Widget</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误做法：每次重建都会创建新的 Widget 实例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadExample</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: [</span><br><span class="line">        _buildHeader(), <span class="comment">// 问题：每次 build 都会重新创建，浪费性能</span></span><br><span class="line">        _buildContent(), <span class="comment">// 同样的问题</span></span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 这个方法每次调用都会创建新的 Container</span></span><br><span class="line">  Widget _buildHeader() &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      height: <span class="number">100</span>,</span><br><span class="line">      color: Colors.blue,</span><br><span class="line">      child: <span class="keyword">const</span> Text(<span class="string">&#x27;标题&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Widget _buildContent() &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      height: <span class="number">200</span>,</span><br><span class="line">      color: Colors.green,</span><br><span class="line">      child: <span class="keyword">const</span> Text(<span class="string">&#x27;内容&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确做法：将静态 Widget 提取为类成员，避免重复创建</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodExample</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 将不变的 Widget 声明为 final 成员变量，只创建一次</span></span><br><span class="line">  <span class="keyword">final</span> Widget header = Container(</span><br><span class="line">    height: <span class="number">100</span>,</span><br><span class="line">    color: Colors.blue,</span><br><span class="line">    child: <span class="keyword">const</span> Text(<span class="string">&#x27;标题&#x27;</span>),</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">final</span> Widget content = Container(</span><br><span class="line">    height: <span class="number">200</span>,</span><br><span class="line">    color: Colors.green,</span><br><span class="line">    child: <span class="keyword">const</span> Text(<span class="string">&#x27;内容&#x27;</span>),</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: [</span><br><span class="line">        header, <span class="comment">// 直接复用已创建的 Widget 实例</span></span><br><span class="line">        content, <span class="comment">// 避免重复创建，提升性能</span></span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🔥 最佳做法：对于需要参数的 Widget，使用工厂方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BestExample</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 使用工厂方法创建可配置的 Widget</span></span><br><span class="line">  <span class="keyword">static</span> Widget _createHeader(<span class="built_in">String</span> title) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      height: <span class="number">100</span>,</span><br><span class="line">      color: Colors.blue,</span><br><span class="line">      child: Text(title),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: [</span><br><span class="line">        _createHeader(<span class="string">&#x27;动态标题&#x27;</span>), <span class="comment">// 根据需要创建</span></span><br><span class="line">        <span class="keyword">const</span> SizedBox(height: <span class="number">16</span>), <span class="comment">// 使用 const 构造函数</span></span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用-const-构造函数"><a href="#使用-const-构造函数" class="headerlink" title="使用 const 构造函数"></a>使用 const 构造函数</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 使用 const 减少重建</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptimizedWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> OptimizedWidget(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">const</span> Column(</span><br><span class="line">      children: [</span><br><span class="line">        Text(<span class="string">&#x27;静态文本&#x27;</span>), <span class="comment">// const 构造函数</span></span><br><span class="line">        Icon(Icons.star), <span class="comment">// const 构造函数</span></span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-状态管理优化"><a href="#2-状态管理优化" class="headerlink" title="2. 状态管理优化"></a>2. 状态管理优化</h3><h4 id="精确控制-setState-范围"><a href="#精确控制-setState-范围" class="headerlink" title="精确控制 setState 范围"></a>精确控制 setState 范围</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterWidget</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _CounterWidgetState createState() =&gt; _CounterWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_CounterWidgetState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">CounterWidget</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _counter = <span class="number">0</span>; <span class="comment">// 会变化的状态</span></span><br><span class="line">  <span class="built_in">String</span> _title = <span class="string">&#x27;计数器&#x27;</span>; <span class="comment">// 不变的状态</span></span><br><span class="line">  <span class="built_in">bool</span> _isLoading = <span class="keyword">false</span>; <span class="comment">// 加载状态</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _incrementCounter() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      <span class="comment">// ✅ 只更新需要变化的状态，避免不必要的重建</span></span><br><span class="line">      _counter++;</span><br><span class="line">      <span class="comment">// ❌ 避免在这里更新不相关的状态，如 _title</span></span><br><span class="line">      <span class="comment">// _title = &#x27;新标题&#x27;; // 这样会导致整个 Widget 重建</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 模拟异步操作</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; _loadData() <span class="keyword">async</span> &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _isLoading = <span class="keyword">true</span>; <span class="comment">// 只更新加载状态</span></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 模拟网络请求</span></span><br><span class="line">    <span class="keyword">await</span> Future.delayed(<span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">2</span>));</span><br><span class="line">    </span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _isLoading = <span class="keyword">false</span>; <span class="comment">// 只更新加载状态</span></span><br><span class="line">      _counter += <span class="number">10</span>; <span class="comment">// 同时更新计数器</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;CounterWidget build 被调用&#x27;</span>); <span class="comment">// 调试信息：观察重建频率</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: [</span><br><span class="line">        <span class="comment">// 静态内容：_title 不变，所以这个 Text 不会重建</span></span><br><span class="line">        Text(</span><br><span class="line">          _title,</span><br><span class="line">          style: <span class="keyword">const</span> TextStyle(fontSize: <span class="number">24</span>, fontWeight: FontWeight.bold),</span><br><span class="line">        ),</span><br><span class="line">        <span class="keyword">const</span> SizedBox(height: <span class="number">16</span>),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 动态内容：只有 _counter 变化时才重建</span></span><br><span class="line">        CounterDisplay(counter: _counter),</span><br><span class="line">        <span class="keyword">const</span> SizedBox(height: <span class="number">16</span>),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 加载状态显示</span></span><br><span class="line">        <span class="keyword">if</span> (_isLoading)</span><br><span class="line">          <span class="keyword">const</span> CircularProgressIndicator()</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          Row(</span><br><span class="line">            mainAxisAlignment: MainAxisAlignment.spaceEvenly,</span><br><span class="line">            children: [</span><br><span class="line">              ElevatedButton(</span><br><span class="line">                onPressed: _incrementCounter,</span><br><span class="line">                child: <span class="keyword">const</span> Text(<span class="string">&#x27;增加 1&#x27;</span>),</span><br><span class="line">              ),</span><br><span class="line">              ElevatedButton(</span><br><span class="line">                onPressed: _loadData,</span><br><span class="line">                child: <span class="keyword">const</span> Text(<span class="string">&#x27;加载数据 (+10)&#x27;</span>),</span><br><span class="line">              ),</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将变化的部分提取为独立 Widget，实现精确重建</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterDisplay</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> counter;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> CounterDisplay(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.counter&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;CounterDisplay build 被调用，counter: <span class="subst">$counter</span>&#x27;</span>); <span class="comment">// 调试信息</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16</span>),</span><br><span class="line">      decoration: BoxDecoration(</span><br><span class="line">        color: Colors.blue.shade50,</span><br><span class="line">        borderRadius: BorderRadius.circular(<span class="number">8</span>),</span><br><span class="line">        border: Border.all(color: Colors.blue),</span><br><span class="line">      ),</span><br><span class="line">      child: Text(</span><br><span class="line">        <span class="string">&#x27;当前计数: <span class="subst">$counter</span>&#x27;</span>,</span><br><span class="line">        style: <span class="keyword">const</span> TextStyle(</span><br><span class="line">          fontSize: <span class="number">20</span>,</span><br><span class="line">          fontWeight: FontWeight.w600,</span><br><span class="line">          color: Colors.blue,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🔥 进阶技巧：使用 ValueNotifier 进一步优化性能</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptimizedCounterWidget</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _OptimizedCounterWidgetState createState() =&gt; _OptimizedCounterWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_OptimizedCounterWidgetState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">OptimizedCounterWidget</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 使用 ValueNotifier 避免整个 Widget 重建</span></span><br><span class="line">  <span class="keyword">final</span> ValueNotifier&lt;<span class="built_in">int</span>&gt; _counterNotifier = ValueNotifier&lt;<span class="built_in">int</span>&gt;(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> _title = <span class="string">&#x27;优化版计数器&#x27;</span>; <span class="comment">// 不变的状态</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _incrementCounter() &#123;</span><br><span class="line">    <span class="comment">// 只通知监听器，不触发 setState</span></span><br><span class="line">    _counterNotifier.value++;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;OptimizedCounterWidget build 被调用&#x27;</span>); <span class="comment">// 这个应该很少被调用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: [</span><br><span class="line">        Text(</span><br><span class="line">          _title,</span><br><span class="line">          style: <span class="keyword">const</span> TextStyle(fontSize: <span class="number">24</span>, fontWeight: FontWeight.bold),</span><br><span class="line">        ),</span><br><span class="line">        <span class="keyword">const</span> SizedBox(height: <span class="number">16</span>),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 ValueListenableBuilder 只重建必要的部分</span></span><br><span class="line">        ValueListenableBuilder&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">          valueListenable: _counterNotifier,</span><br><span class="line">          builder: (context, counter, child) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;ValueListenableBuilder 重建，counter: <span class="subst">$counter</span>&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> CounterDisplay(counter: counter);</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">        <span class="keyword">const</span> SizedBox(height: <span class="number">16</span>),</span><br><span class="line">        </span><br><span class="line">        ElevatedButton(</span><br><span class="line">          onPressed: _incrementCounter,</span><br><span class="line">          child: <span class="keyword">const</span> Text(<span class="string">&#x27;增加&#x27;</span>),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _counterNotifier.dispose(); <span class="comment">// 释放资源</span></span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="3-列表性能优化"><a href="#3-列表性能优化" class="headerlink" title="3. 列表性能优化"></a>3. 列表性能优化</h3><h4 id="使用-ListView-builder-处理大数据"><a href="#使用-ListView-builder-处理大数据" class="headerlink" title="使用 ListView.builder 处理大数据"></a>使用 ListView.builder 处理大数据</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 高效的列表实现：只渲染可见区域的 item</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EfficientListView</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; items;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> EfficientListView(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.items&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ListView.builder(</span><br><span class="line">      itemCount: items.length, <span class="comment">// 总数据量</span></span><br><span class="line">      <span class="comment">// 关键优化：只构建当前可见的 item，而不是全部</span></span><br><span class="line">      itemBuilder: (context, index) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;构建第 <span class="subst">$index</span> 个 item&#x27;</span>); <span class="comment">// 调试信息：观察构建频率</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ListTile(</span><br><span class="line">          leading: CircleAvatar(</span><br><span class="line">            backgroundColor: Colors.blue,</span><br><span class="line">            child: Text(<span class="string">&#x27;<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>&#x27;</span>),</span><br><span class="line">          ),</span><br><span class="line">          title: Text(items[index]),</span><br><span class="line">          subtitle: Text(<span class="string">&#x27;索引: <span class="subst">$index</span>&#x27;</span>),</span><br><span class="line">          trailing: <span class="keyword">const</span> Icon(Icons.arrow_forward_ios),</span><br><span class="line">          <span class="comment">// 使用 key 优化重建性能，避免 Widget 错位</span></span><br><span class="line">          key: ValueKey(<span class="string">&#x27;item_<span class="subst">$index</span>&#x27;</span>),</span><br><span class="line">          onTap: () &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;点击了第 <span class="subst">$index</span> 个 item: <span class="subst">$&#123;items[index]&#125;</span>&#x27;</span>);</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 性能优化配置</span></span><br><span class="line">      physics: <span class="keyword">const</span> BouncingScrollPhysics(), <span class="comment">// 使用弹性滚动</span></span><br><span class="line">      cacheExtent: <span class="number">200</span>, <span class="comment">// 缓存区域大小，提前渲染即将可见的内容</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 错误做法：一次性创建所有 Widget</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InEfficientListView</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; items;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> InEfficientListView(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.items&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ListView(</span><br><span class="line">      children: items.map((item) &#123;</span><br><span class="line">        <span class="comment">// 问题：即使有10000个 item，也会一次性全部创建</span></span><br><span class="line">        <span class="keyword">return</span> ListTile(title: Text(item));</span><br><span class="line">      &#125;).toList(), <span class="comment">// 这会创建一个巨大的 Widget 列表</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🔥 进阶优化：自定义 item 高度和分隔符</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdvancedListView</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; items;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> AdvancedListView(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.items&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ListView.separated(</span><br><span class="line">      itemCount: items.length,</span><br><span class="line">      <span class="comment">// 构建列表项</span></span><br><span class="line">      itemBuilder: (context, index) &#123;</span><br><span class="line">        <span class="keyword">return</span> Container(</span><br><span class="line">          height: <span class="number">80</span>, <span class="comment">// 固定高度有助于性能优化</span></span><br><span class="line">          padding: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">16</span>, vertical: <span class="number">8</span>),</span><br><span class="line">          child: Row(</span><br><span class="line">            children: [</span><br><span class="line">              Container(</span><br><span class="line">                width: <span class="number">50</span>,</span><br><span class="line">                height: <span class="number">50</span>,</span><br><span class="line">                decoration: BoxDecoration(</span><br><span class="line">                  color: Colors.blue.shade100,</span><br><span class="line">                  borderRadius: BorderRadius.circular(<span class="number">25</span>),</span><br><span class="line">                ),</span><br><span class="line">                child: Center(</span><br><span class="line">                  child: Text(</span><br><span class="line">                    <span class="string">&#x27;<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>&#x27;</span>,</span><br><span class="line">                    style: <span class="keyword">const</span> TextStyle(fontWeight: FontWeight.bold),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">              <span class="keyword">const</span> SizedBox(width: <span class="number">16</span>),</span><br><span class="line">              Expanded(</span><br><span class="line">                child: Column(</span><br><span class="line">                  crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">                  mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">                  children: [</span><br><span class="line">                    Text(</span><br><span class="line">                      items[index],</span><br><span class="line">                      style: <span class="keyword">const</span> TextStyle(</span><br><span class="line">                        fontSize: <span class="number">16</span>,</span><br><span class="line">                        fontWeight: FontWeight.w600,</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                    <span class="keyword">const</span> SizedBox(height: <span class="number">4</span>),</span><br><span class="line">                    Text(</span><br><span class="line">                      <span class="string">&#x27;创建时间: <span class="subst">$&#123;DateTime.now().toString().substring(<span class="number">0</span>, <span class="number">19</span>)&#125;</span>&#x27;</span>,</span><br><span class="line">                      style: TextStyle(</span><br><span class="line">                        fontSize: <span class="number">12</span>,</span><br><span class="line">                        color: Colors.grey.shade600,</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  ],</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 分隔符构建器</span></span><br><span class="line">      separatorBuilder: (context, index) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">const</span> Divider(</span><br><span class="line">          height: <span class="number">1</span>,</span><br><span class="line">          thickness: <span class="number">1</span>,</span><br><span class="line">          indent: <span class="number">66</span>, <span class="comment">// 与头像对齐</span></span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现懒加载"><a href="#实现懒加载" class="headerlink" title="实现懒加载"></a>实现懒加载</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🔥 完整的懒加载列表实现，包含错误处理和状态管理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazyLoadingList</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _LazyLoadingListState createState() =&gt; _LazyLoadingListState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_LazyLoadingListState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">LazyLoadingList</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; _items = []; <span class="comment">// 存储列表数据</span></span><br><span class="line">  <span class="built_in">bool</span> _isLoading = <span class="keyword">false</span>; <span class="comment">// 加载状态标识</span></span><br><span class="line">  <span class="built_in">bool</span> _hasError = <span class="keyword">false</span>; <span class="comment">// 错误状态标识</span></span><br><span class="line">  <span class="built_in">bool</span> _hasMoreData = <span class="keyword">true</span>; <span class="comment">// 是否还有更多数据可加载</span></span><br><span class="line">  <span class="built_in">String</span> _errorMessage = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 错误信息存储</span></span><br><span class="line">  <span class="keyword">final</span> ScrollController _scrollController = ScrollController();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 分页参数配置</span></span><br><span class="line">  <span class="built_in">int</span> _currentPage = <span class="number">0</span>; <span class="comment">// 当前页码，从0开始</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> _pageSize = <span class="number">20</span>; <span class="comment">// 每页加载的数据量</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _loadInitialData(); <span class="comment">// 加载初始数据</span></span><br><span class="line">    _scrollController.addListener(_onScroll); <span class="comment">// 监听滚动</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 滚动监听器：智能检测是否需要加载更多数据</span></span><br><span class="line">  <span class="keyword">void</span> _onScroll() &#123;</span><br><span class="line">    <span class="comment">// 当滚动接近底部时提前触发加载，提升用户体验</span></span><br><span class="line">    <span class="keyword">if</span> (_scrollController.position.pixels &gt;= </span><br><span class="line">        _scrollController.position.maxScrollExtent - <span class="number">200</span>) &#123; <span class="comment">// 提前200像素开始预加载</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;📍 滚动触发懒加载，当前位置: <span class="subst">$&#123;_scrollController.position.pixels&#125;</span>&#x27;</span>);</span><br><span class="line">      _loadMoreData();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 加载初始数据 - 应用启动时的第一次数据加载</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; _loadInitialData() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🚀 开始加载初始数据...&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _isLoading = <span class="keyword">true</span>;</span><br><span class="line">      _hasError = <span class="keyword">false</span>;</span><br><span class="line">      _currentPage = <span class="number">0</span>;</span><br><span class="line">      _errorMessage = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 模拟网络请求延迟</span></span><br><span class="line">      <span class="keyword">await</span> Future.delayed(<span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">1</span>));</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 模拟随机网络错误（10%概率）</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">DateTime</span>.now().millisecond % <span class="number">10</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> Exception(<span class="string">&#x27;网络连接超时，请检查网络设置&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 生成第一页数据</span></span><br><span class="line">      <span class="keyword">final</span> newItems = <span class="built_in">List</span>.generate(</span><br><span class="line">        _pageSize, </span><br><span class="line">        (index) =&gt; <span class="string">&#x27;Item <span class="subst">$&#123;_currentPage * _pageSize + index + <span class="number">1</span>&#125;</span> - 初始数据&#x27;</span></span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _items.clear(); <span class="comment">// 清空现有数据</span></span><br><span class="line">        _items.addAll(newItems);</span><br><span class="line">        _isLoading = <span class="keyword">false</span>;</span><br><span class="line">        _currentPage++; <span class="comment">// 页码递增</span></span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 初始数据加载成功，共<span class="subst">$&#123;newItems.length&#125;</span>条&#x27;</span>);</span><br><span class="line">      </span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _isLoading = <span class="keyword">false</span>;</span><br><span class="line">        _hasError = <span class="keyword">true</span>;</span><br><span class="line">        _errorMessage = e.toString();</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;❌ 初始数据加载失败: <span class="subst">$e</span>&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 加载更多数据 - 懒加载的核心实现</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; _loadMoreData() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="comment">// 防止重复加载和无效请求</span></span><br><span class="line">    <span class="keyword">if</span> (_isLoading || !_hasMoreData || _hasError) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;⚠️ 跳过加载：isLoading=<span class="subst">$_isLoading</span>, hasMoreData=<span class="subst">$_hasMoreData</span>, hasError=<span class="subst">$_hasError</span>&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;📡 开始加载第<span class="subst">$&#123;_currentPage + <span class="number">1</span>&#125;</span>页数据...&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _isLoading = <span class="keyword">true</span>;</span><br><span class="line">      _hasError = <span class="keyword">false</span>;</span><br><span class="line">      _errorMessage = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 模拟真实的网络请求延迟</span></span><br><span class="line">      <span class="keyword">await</span> Future.delayed(<span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">800</span>));</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 模拟数据加载完毕的情况（总共100条数据）</span></span><br><span class="line">      <span class="keyword">if</span> (_items.length &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">        setState(() &#123;</span><br><span class="line">          _isLoading = <span class="keyword">false</span>;</span><br><span class="line">          _hasMoreData = <span class="keyword">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;🎉 所有数据加载完成，共<span class="subst">$&#123;_items.length&#125;</span>条&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 模拟随机网络错误（约7%概率）</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">DateTime</span>.now().millisecond % <span class="number">15</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> Exception(<span class="string">&#x27;网络请求超时，请检查网络连接&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 生成新的数据页</span></span><br><span class="line">      <span class="keyword">final</span> newItems = <span class="built_in">List</span>.generate(</span><br><span class="line">        <span class="number">10</span>, <span class="comment">// 后续每次加载10条数据，减少加载时间</span></span><br><span class="line">        (index) =&gt; <span class="string">&#x27;Item <span class="subst">$&#123;_items.length + index + <span class="number">1</span>&#125;</span> - 第<span class="subst">$&#123;_currentPage + <span class="number">1</span>&#125;</span>页&#x27;</span></span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _items.addAll(newItems);</span><br><span class="line">        _isLoading = <span class="keyword">false</span>;</span><br><span class="line">        _currentPage++;</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 第<span class="subst">$_currentPage</span>页加载完成，新增<span class="subst">$&#123;newItems.length&#125;</span>条，总计<span class="subst">$&#123;_items.length&#125;</span>条&#x27;</span>);</span><br><span class="line">      </span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _isLoading = <span class="keyword">false</span>;</span><br><span class="line">        _hasError = <span class="keyword">true</span>;</span><br><span class="line">        _errorMessage = e.toString();</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;❌ 数据加载失败: <span class="subst">$e</span>&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 重试加载</span></span><br><span class="line">  <span class="keyword">void</span> _retryLoad() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_items.isEmpty) &#123;</span><br><span class="line">      _loadInitialData();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _loadMoreData();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 下拉刷新 - 重置所有状态并重新加载</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; _onRefresh() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🔄 用户触发下拉刷新&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _hasMoreData = <span class="keyword">true</span>; <span class="comment">// 重置数据状态</span></span><br><span class="line">      _hasError = <span class="keyword">false</span>; <span class="comment">// 清除错误状态</span></span><br><span class="line">      _errorMessage = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">await</span> _loadInitialData(); <span class="comment">// 重新加载初始数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;✅ 下拉刷新完成&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// 如果初始加载失败，显示错误页面</span></span><br><span class="line">    <span class="keyword">if</span> (_items.isEmpty &amp;&amp; _hasError) &#123;</span><br><span class="line">      <span class="keyword">return</span> Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: [</span><br><span class="line">            <span class="keyword">const</span> Icon(</span><br><span class="line">              Icons.error_outline,</span><br><span class="line">              size: <span class="number">64</span>,</span><br><span class="line">              color: Colors.red,</span><br><span class="line">            ),</span><br><span class="line">            <span class="keyword">const</span> SizedBox(height: <span class="number">16</span>),</span><br><span class="line">            Text(</span><br><span class="line">              <span class="string">&#x27;加载失败&#x27;</span>,</span><br><span class="line">              style: Theme.of(context).textTheme.headlineSmall,</span><br><span class="line">            ),</span><br><span class="line">            <span class="keyword">const</span> SizedBox(height: <span class="number">8</span>),</span><br><span class="line">            Text(</span><br><span class="line">              _errorMessage,</span><br><span class="line">              style: Theme.of(context).textTheme.bodyMedium,</span><br><span class="line">              textAlign: TextAlign.center,</span><br><span class="line">            ),</span><br><span class="line">            <span class="keyword">const</span> SizedBox(height: <span class="number">16</span>),</span><br><span class="line">            ElevatedButton(</span><br><span class="line">              onPressed: _retryLoad,</span><br><span class="line">              child: <span class="keyword">const</span> Text(<span class="string">&#x27;重试&#x27;</span>),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果正在初始加载，显示加载指示器</span></span><br><span class="line">    <span class="keyword">if</span> (_items.isEmpty &amp;&amp; _isLoading) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">const</span> Center(</span><br><span class="line">        child: CircularProgressIndicator(),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 主列表界面</span></span><br><span class="line">    <span class="keyword">return</span> RefreshIndicator(</span><br><span class="line">      onRefresh: _onRefresh, <span class="comment">// 下拉刷新</span></span><br><span class="line">      child: ListView.builder(</span><br><span class="line">        controller: _scrollController,</span><br><span class="line">        physics: <span class="keyword">const</span> AlwaysScrollableScrollPhysics(), <span class="comment">// 确保可以下拉刷新</span></span><br><span class="line">        itemCount: _items.length + <span class="number">1</span>, <span class="comment">// +1 用于底部状态显示</span></span><br><span class="line">        itemBuilder: (context, index) &#123;</span><br><span class="line">          <span class="comment">// 列表项</span></span><br><span class="line">          <span class="keyword">if</span> (index &lt; _items.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> ListTile(</span><br><span class="line">              leading: CircleAvatar(</span><br><span class="line">                backgroundColor: Colors.blue,</span><br><span class="line">                child: Text(<span class="string">&#x27;<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>&#x27;</span>),</span><br><span class="line">              ),</span><br><span class="line">              title: Text(_items[index]),</span><br><span class="line">              subtitle: Text(<span class="string">&#x27;索引: <span class="subst">$index</span>&#x27;</span>),</span><br><span class="line">              key: ValueKey(<span class="string">&#x27;lazy_item_<span class="subst">$index</span>&#x27;</span>),</span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// 底部状态显示</span></span><br><span class="line">          <span class="keyword">return</span> _buildBottomWidget();</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 构建底部状态 Widget</span></span><br><span class="line">  Widget _buildBottomWidget() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_isLoading) &#123;</span><br><span class="line">      <span class="comment">// 正在加载</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">const</span> Padding(</span><br><span class="line">        padding: EdgeInsets.all(<span class="number">16</span>),</span><br><span class="line">        child: Center(</span><br><span class="line">          child: Row(</span><br><span class="line">            mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">            children: [</span><br><span class="line">              SizedBox(</span><br><span class="line">                width: <span class="number">20</span>,</span><br><span class="line">                height: <span class="number">20</span>,</span><br><span class="line">                child: CircularProgressIndicator(strokeWidth: <span class="number">2</span>),</span><br><span class="line">              ),</span><br><span class="line">              SizedBox(width: <span class="number">12</span>),</span><br><span class="line">              Text(<span class="string">&#x27;正在加载...&#x27;</span>),</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (_hasError) &#123;</span><br><span class="line">      <span class="comment">// 加载错误</span></span><br><span class="line">      <span class="keyword">return</span> Padding(</span><br><span class="line">        padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16</span>),</span><br><span class="line">        child: Center(</span><br><span class="line">          child: Column(</span><br><span class="line">            children: [</span><br><span class="line">              Text(</span><br><span class="line">                <span class="string">&#x27;加载失败: <span class="subst">$_errorMessage</span>&#x27;</span>,</span><br><span class="line">                style: <span class="keyword">const</span> TextStyle(color: Colors.red),</span><br><span class="line">                textAlign: TextAlign.center,</span><br><span class="line">              ),</span><br><span class="line">              <span class="keyword">const</span> SizedBox(height: <span class="number">8</span>),</span><br><span class="line">              ElevatedButton(</span><br><span class="line">                onPressed: _retryLoad,</span><br><span class="line">                child: <span class="keyword">const</span> Text(<span class="string">&#x27;重试&#x27;</span>),</span><br><span class="line">              ),</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!_hasMoreData) &#123;</span><br><span class="line">      <span class="comment">// 没有更多数据</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">const</span> Padding(</span><br><span class="line">        padding: EdgeInsets.all(<span class="number">16</span>),</span><br><span class="line">        child: Center(</span><br><span class="line">          child: Text(</span><br><span class="line">            <span class="string">&#x27;没有更多数据了&#x27;</span>,</span><br><span class="line">            style: TextStyle(color: Colors.grey),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 默认情况：空白区域</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">const</span> SizedBox(height: <span class="number">50</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _scrollController.dispose(); <span class="comment">// 释放滚动控制器</span></span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🔥 使用 Provider 或 Bloc 的懒加载实现（更高级的状态管理）</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdvancedLazyLoadingList</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _AdvancedLazyLoadingListState createState() =&gt; _AdvancedLazyLoadingListState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_AdvancedLazyLoadingListState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">AdvancedLazyLoadingList</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> ScrollController _scrollController = ScrollController();</span><br><span class="line">  <span class="keyword">final</span> ValueNotifier&lt;<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;&gt; _itemsNotifier = ValueNotifier&lt;<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;&gt;([]);</span><br><span class="line">  <span class="keyword">final</span> ValueNotifier&lt;<span class="built_in">bool</span>&gt; _isLoadingNotifier = ValueNotifier&lt;<span class="built_in">bool</span>&gt;(<span class="keyword">false</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _loadInitialData();</span><br><span class="line">    _scrollController.addListener(_onScroll);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _onScroll() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_scrollController.position.pixels &gt;= </span><br><span class="line">        _scrollController.position.maxScrollExtent - <span class="number">100</span>) &#123;</span><br><span class="line">      _loadMoreData();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; _loadInitialData() <span class="keyword">async</span> &#123;</span><br><span class="line">    _isLoadingNotifier.value = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">await</span> Future.delayed(<span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">1</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> items = <span class="built_in">List</span>.generate(<span class="number">20</span>, (index) =&gt; <span class="string">&#x27;Advanced Item <span class="subst">$index</span>&#x27;</span>);</span><br><span class="line">    _itemsNotifier.value = items;</span><br><span class="line">    _isLoadingNotifier.value = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; _loadMoreData() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (_isLoadingNotifier.value) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    _isLoadingNotifier.value = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">await</span> Future.delayed(<span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">800</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> currentItems = _itemsNotifier.value;</span><br><span class="line">    <span class="keyword">final</span> newItems = <span class="built_in">List</span>.generate(</span><br><span class="line">      <span class="number">10</span>, </span><br><span class="line">      (index) =&gt; <span class="string">&#x27;Advanced Item <span class="subst">$&#123;currentItems.length + index&#125;</span>&#x27;</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    _itemsNotifier.value = [...currentItems, ...newItems];</span><br><span class="line">    _isLoadingNotifier.value = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ValueListenableBuilder&lt;<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;&gt;(</span><br><span class="line">      valueListenable: _itemsNotifier,</span><br><span class="line">      builder: (context, items, child) &#123;</span><br><span class="line">        <span class="keyword">return</span> ListView.builder(</span><br><span class="line">          controller: _scrollController,</span><br><span class="line">          itemCount: items.length + <span class="number">1</span>,</span><br><span class="line">          itemBuilder: (context, index) &#123;</span><br><span class="line">            <span class="keyword">if</span> (index &lt; items.length) &#123;</span><br><span class="line">              <span class="keyword">return</span> ListTile(</span><br><span class="line">                title: Text(items[index]),</span><br><span class="line">                key: ValueKey(<span class="string">&#x27;advanced_item_<span class="subst">$index</span>&#x27;</span>),</span><br><span class="line">              );</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> ValueListenableBuilder&lt;<span class="built_in">bool</span>&gt;(</span><br><span class="line">              valueListenable: _isLoadingNotifier,</span><br><span class="line">              builder: (context, isLoading, child) &#123;</span><br><span class="line">                <span class="keyword">return</span> isLoading</span><br><span class="line">                    ? <span class="keyword">const</span> Padding(</span><br><span class="line">                        padding: EdgeInsets.all(<span class="number">16</span>),</span><br><span class="line">                        child: Center(child: CircularProgressIndicator()),</span><br><span class="line">                      )</span><br><span class="line">                    : <span class="keyword">const</span> SizedBox(height: <span class="number">50</span>);</span><br><span class="line">              &#125;,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _scrollController.dispose();</span><br><span class="line">    _itemsNotifier.dispose();</span><br><span class="line">    _isLoadingNotifier.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">## 性能优化策略</span><br><span class="line"></span><br><span class="line">### <span class="number">1.</span> 避免不必要的重建</span><br><span class="line"></span><br><span class="line">#### 使用 RepaintBoundary</span><br><span class="line"></span><br><span class="line">```dart</span><br><span class="line"><span class="comment">// 将不需要频繁重绘的部分包装起来</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptimizedWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: [</span><br><span class="line">        RepaintBoundary(</span><br><span class="line">          <span class="comment">// 静态内容，避免重绘</span></span><br><span class="line">          child: ExpensiveWidget(),</span><br><span class="line">        ),</span><br><span class="line">        DynamicWidget(), <span class="comment">// 动态内容</span></span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用-AutomaticKeepAliveClientMixin"><a href="#使用-AutomaticKeepAliveClientMixin" class="headerlink" title="使用 AutomaticKeepAliveClientMixin"></a>使用 AutomaticKeepAliveClientMixin</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保持页面状态，避免重建</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KeepAliveTab</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _KeepAliveTabState createState() =&gt; _KeepAliveTabState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_KeepAliveTabState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">KeepAliveTab</span>&gt; </span></span><br><span class="line"><span class="class">    <span class="title">with</span> <span class="title">AutomaticKeepAliveClientMixin</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> <span class="keyword">get</span> wantKeepAlive =&gt; <span class="keyword">true</span>; <span class="comment">// 保持状态</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">super</span>.build(context); <span class="comment">// 必须调用</span></span><br><span class="line">    <span class="keyword">return</span> ExpensiveWidget();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-图片优化"><a href="#2-图片优化" class="headerlink" title="2. 图片优化"></a>2. 图片优化</h3><h4 id="网络图片缓存优化"><a href="#网络图片缓存优化" class="headerlink" title="网络图片缓存优化"></a>网络图片缓存优化</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 推荐：使用 CachedNetworkImage 进行网络图片缓存</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:cached_network_image/cached_network_image.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptimizedImageWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> imageUrl;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double?</span> width;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double?</span> height;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> OptimizedImageWidget(&#123;</span><br><span class="line">    Key? key,</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.imageUrl,</span><br><span class="line">    <span class="keyword">this</span>.width,</span><br><span class="line">    <span class="keyword">this</span>.height,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> CachedNetworkImage(</span><br><span class="line">      imageUrl: imageUrl,</span><br><span class="line">      width: width,</span><br><span class="line">      height: height,</span><br><span class="line">      fit: BoxFit.cover, <span class="comment">// 指定合适的填充方式</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 占位符 - 加载时显示</span></span><br><span class="line">      placeholder: (context, url) =&gt; Container(</span><br><span class="line">        width: width,</span><br><span class="line">        height: height,</span><br><span class="line">        color: Colors.grey[<span class="number">200</span>],</span><br><span class="line">        child: Center(</span><br><span class="line">          child: CircularProgressIndicator(</span><br><span class="line">            strokeWidth: <span class="number">2</span>,</span><br><span class="line">            valueColor: AlwaysStoppedAnimation&lt;Color&gt;(Colors.blue),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 错误处理 - 加载失败时显示</span></span><br><span class="line">      errorWidget: (context, url, error) =&gt; Container(</span><br><span class="line">        width: width,</span><br><span class="line">        height: height,</span><br><span class="line">        color: Colors.grey[<span class="number">100</span>],</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: [</span><br><span class="line">            Icon(Icons.broken_image, color: Colors.grey[<span class="number">400</span>], size: <span class="number">32</span>),</span><br><span class="line">            SizedBox(height: <span class="number">8</span>),</span><br><span class="line">            Text(</span><br><span class="line">              <span class="string">&#x27;图片加载失败&#x27;</span>,</span><br><span class="line">              style: TextStyle(color: Colors.grey[<span class="number">600</span>], fontSize: <span class="number">12</span>),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 缓存配置</span></span><br><span class="line">      cacheManager: DefaultCacheManager(),</span><br><span class="line">      maxWidthDiskCache: <span class="number">1000</span>, <span class="comment">// 限制缓存图片的最大宽度</span></span><br><span class="line">      maxHeightDiskCache: <span class="number">1000</span>, <span class="comment">// 限制缓存图片的最大高度</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 渐显动画</span></span><br><span class="line">      fadeInDuration: <span class="built_in">Duration</span>(milliseconds: <span class="number">300</span>),</span><br><span class="line">      fadeOutDuration: <span class="built_in">Duration</span>(milliseconds: <span class="number">100</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="图片预加载策略"><a href="#图片预加载策略" class="headerlink" title="图片预加载策略"></a>图片预加载策略</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImagePreloader</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 预加载关键图片，提升用户体验</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="keyword">void</span>&gt; preloadCriticalImages(BuildContext context) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> imagesToPreload = [</span><br><span class="line">      <span class="string">&#x27;assets/images/logo.png&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;assets/images/background.jpg&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;assets/images/placeholder.png&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🖼️ 开始预加载<span class="subst">$&#123;imagesToPreload.length&#125;</span>张关键图片...&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 并行预加载多张图片</span></span><br><span class="line">      <span class="keyword">await</span> Future.wait(</span><br><span class="line">        imagesToPreload.map((imagePath) =&gt; </span><br><span class="line">          precacheImage(AssetImage(imagePath), context)</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 关键图片预加载完成&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;❌ 图片预加载失败: <span class="subst">$e</span>&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 预加载网络图片</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="keyword">void</span>&gt; preloadNetworkImage(</span><br><span class="line">    BuildContext context, </span><br><span class="line">    <span class="built_in">String</span> imageUrl</span><br><span class="line">  ) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> precacheImage(NetworkImage(imageUrl), context);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 网络图片预加载完成: <span class="subst">$imageUrl</span>&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;❌ 网络图片预加载失败: <span class="subst">$e</span>&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="图片尺寸优化"><a href="#图片尺寸优化" class="headerlink" title="图片尺寸优化"></a>图片尺寸优化</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：加载过大的图片</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadImageExample</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      width: <span class="number">100</span>,</span><br><span class="line">      height: <span class="number">100</span>,</span><br><span class="line">      child: Image.asset(</span><br><span class="line">        <span class="string">&#x27;assets/images/large_image.jpg&#x27;</span>, <span class="comment">// 4K分辨率图片</span></span><br><span class="line">        fit: BoxFit.cover,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 推荐：使用合适尺寸的图片</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodImageExample</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      width: <span class="number">100</span>,</span><br><span class="line">      height: <span class="number">100</span>,</span><br><span class="line">      child: Image.asset(</span><br><span class="line">        <span class="string">&#x27;assets/images/thumbnail_100x100.jpg&#x27;</span>, <span class="comment">// 合适尺寸的缩略图</span></span><br><span class="line">        fit: BoxFit.cover,</span><br><span class="line">        <span class="comment">// 指定缓存尺寸，避免内存浪费</span></span><br><span class="line">        cacheWidth: <span class="number">100</span>,</span><br><span class="line">        cacheHeight: <span class="number">100</span>,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="响应式图片加载"><a href="#响应式图片加载" class="headerlink" title="响应式图片加载"></a>响应式图片加载</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResponsiveImageWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> imageUrl;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> ResponsiveImageWidget(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.imageUrl&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> LayoutBuilder(</span><br><span class="line">      builder: (context, constraints) &#123;</span><br><span class="line">        <span class="comment">// 根据容器大小选择合适的图片尺寸</span></span><br><span class="line">        <span class="keyword">final</span> width = constraints.maxWidth;</span><br><span class="line">        <span class="keyword">final</span> height = constraints.maxHeight;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Image.network(</span><br><span class="line">          imageUrl,</span><br><span class="line">          width: width,</span><br><span class="line">          height: height,</span><br><span class="line">          fit: BoxFit.cover,</span><br><span class="line">          <span class="comment">// 根据实际显示尺寸设置缓存大小</span></span><br><span class="line">          cacheWidth: width.toInt(),</span><br><span class="line">          cacheHeight: height.toInt(),</span><br><span class="line">          loadingBuilder: (context, child, loadingProgress) &#123;</span><br><span class="line">            <span class="keyword">if</span> (loadingProgress == <span class="keyword">null</span>) <span class="keyword">return</span> child;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> Container(</span><br><span class="line">              width: width,</span><br><span class="line">              height: height,</span><br><span class="line">              color: Colors.grey[<span class="number">200</span>],</span><br><span class="line">              child: Center(</span><br><span class="line">                child: CircularProgressIndicator(</span><br><span class="line">                  value: loadingProgress.expectedTotalBytes != <span class="keyword">null</span></span><br><span class="line">                      ? loadingProgress.cumulativeBytesLoaded /</span><br><span class="line">                          loadingProgress.expectedTotalBytes!</span><br><span class="line">                      : <span class="keyword">null</span>,</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-动画优化"><a href="#3-动画优化" class="headerlink" title="3. 动画优化"></a>3. 动画优化</h3><h4 id="使用-AnimatedBuilder-优化动画性能"><a href="#使用-AnimatedBuilder-优化动画性能" class="headerlink" title="使用 AnimatedBuilder 优化动画性能"></a>使用 AnimatedBuilder 优化动画性能</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 推荐：使用 AnimatedBuilder 避免不必要的重建</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptimizedAnimation</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _OptimizedAnimationState createState() =&gt; _OptimizedAnimationState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_OptimizedAnimationState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">OptimizedAnimation</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">with</span> <span class="title">TickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">late</span> AnimationController _controller;</span><br><span class="line">  <span class="keyword">late</span> Animation&lt;<span class="built_in">double</span>&gt; _scaleAnimation;</span><br><span class="line">  <span class="keyword">late</span> Animation&lt;<span class="built_in">double</span>&gt; _rotationAnimation;</span><br><span class="line">  <span class="keyword">late</span> Animation&lt;Color?&gt; _colorAnimation;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    </span><br><span class="line">    _controller = AnimationController(</span><br><span class="line">      duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">2</span>),</span><br><span class="line">      vsync: <span class="keyword">this</span>,</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建多个动画，复用同一个控制器</span></span><br><span class="line">    _scaleAnimation = Tween&lt;<span class="built_in">double</span>&gt;(</span><br><span class="line">      begin: <span class="number">0.5</span>,</span><br><span class="line">      end: <span class="number">1.5</span>,</span><br><span class="line">    ).animate(CurvedAnimation(</span><br><span class="line">      parent: _controller,</span><br><span class="line">      curve: Curves.elasticOut, <span class="comment">// 使用合适的缓动曲线</span></span><br><span class="line">    ));</span><br><span class="line">    </span><br><span class="line">    _rotationAnimation = Tween&lt;<span class="built_in">double</span>&gt;(</span><br><span class="line">      begin: <span class="number">0</span>,</span><br><span class="line">      end: <span class="number">2</span> * <span class="number">3.14159</span>, <span class="comment">// 360度旋转</span></span><br><span class="line">    ).animate(CurvedAnimation(</span><br><span class="line">      parent: _controller,</span><br><span class="line">      curve: Curves.easeInOut,</span><br><span class="line">    ));</span><br><span class="line">    </span><br><span class="line">    _colorAnimation = ColorTween(</span><br><span class="line">      begin: Colors.blue,</span><br><span class="line">      end: Colors.red,</span><br><span class="line">    ).animate(_controller);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">      children: [</span><br><span class="line">        <span class="comment">// 静态标题，不参与动画</span></span><br><span class="line">        <span class="keyword">const</span> Text(</span><br><span class="line">          <span class="string">&#x27;动画演示&#x27;</span>,</span><br><span class="line">          style: TextStyle(fontSize: <span class="number">24</span>, fontWeight: FontWeight.bold),</span><br><span class="line">        ),</span><br><span class="line">        <span class="keyword">const</span> SizedBox(height: <span class="number">32</span>),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 AnimatedBuilder 优化性能</span></span><br><span class="line">        AnimatedBuilder(</span><br><span class="line">          animation: _controller,</span><br><span class="line">          <span class="comment">// 静态部分作为 child 传入，避免重建</span></span><br><span class="line">          child: <span class="keyword">const</span> ExpensiveStaticWidget(),</span><br><span class="line">          builder: (context, child) &#123;</span><br><span class="line">            <span class="keyword">return</span> Transform.scale(</span><br><span class="line">              scale: _scaleAnimation.value,</span><br><span class="line">              child: Transform.rotate(</span><br><span class="line">                angle: _rotationAnimation.value,</span><br><span class="line">                child: Container(</span><br><span class="line">                  width: <span class="number">100</span>,</span><br><span class="line">                  height: <span class="number">100</span>,</span><br><span class="line">                  decoration: BoxDecoration(</span><br><span class="line">                    color: _colorAnimation.value,</span><br><span class="line">                    borderRadius: BorderRadius.circular(<span class="number">12</span>),</span><br><span class="line">                    boxShadow: [</span><br><span class="line">                      BoxShadow(</span><br><span class="line">                        color: Colors.black26,</span><br><span class="line">                        blurRadius: <span class="number">8</span>,</span><br><span class="line">                        offset: Offset(<span class="number">0</span>, <span class="number">4</span>),</span><br><span class="line">                      ),</span><br><span class="line">                    ],</span><br><span class="line">                  ),</span><br><span class="line">                  child: child, <span class="comment">// 复用静态部分，避免重建</span></span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">        <span class="keyword">const</span> SizedBox(height: <span class="number">32</span>),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 控制按钮</span></span><br><span class="line">        Row(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.spaceEvenly,</span><br><span class="line">          children: [</span><br><span class="line">            ElevatedButton(</span><br><span class="line">              onPressed: () &#123;</span><br><span class="line">                <span class="keyword">if</span> (_controller.status == AnimationStatus.completed) &#123;</span><br><span class="line">                  _controller.reverse();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  _controller.forward();</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              child: Text(_controller.status == AnimationStatus.completed </span><br><span class="line">                  ? <span class="string">&#x27;反向播放&#x27;</span> : <span class="string">&#x27;开始动画&#x27;</span>),</span><br><span class="line">            ),</span><br><span class="line">            ElevatedButton(</span><br><span class="line">              onPressed: () =&gt; _controller.reset(),</span><br><span class="line">              child: <span class="keyword">const</span> Text(<span class="string">&#x27;重置&#x27;</span>),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _controller.dispose(); <span class="comment">// 释放动画控制器</span></span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态组件，不会因为动画而重建</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExpensiveStaticWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ExpensiveStaticWidget(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ExpensiveStaticWidget 被构建&#x27;</span>); <span class="comment">// 调试信息</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">const</span> Icon(</span><br><span class="line">      Icons.star,</span><br><span class="line">      size: <span class="number">40</span>,</span><br><span class="line">      color: Colors.white,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="高性能列表动画"><a href="#高性能列表动画" class="headerlink" title="高性能列表动画"></a>高性能列表动画</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 使用 AnimatedList 实现高性能列表动画</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimatedListExample</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _AnimatedListExampleState createState() =&gt; _AnimatedListExampleState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_AnimatedListExampleState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">AnimatedListExample</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> GlobalKey&lt;AnimatedListState&gt; _listKey = GlobalKey&lt;AnimatedListState&gt;();</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; _items = [<span class="string">&#x27;Item 1&#x27;</span>, <span class="string">&#x27;Item 2&#x27;</span>, <span class="string">&#x27;Item 3&#x27;</span>];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _addItem() &#123;</span><br><span class="line">    <span class="keyword">final</span> index = _items.length;</span><br><span class="line">    _items.insert(index, <span class="string">&#x27;Item <span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>&#x27;</span>);</span><br><span class="line">    _listKey.currentState?.insertItem(index, duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">300</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _removeItem(<span class="built_in">int</span> index) &#123;</span><br><span class="line">    <span class="keyword">final</span> removedItem = _items.removeAt(index);</span><br><span class="line">    _listKey.currentState?.removeItem(</span><br><span class="line">      index,</span><br><span class="line">      (context, animation) =&gt; _buildItem(removedItem, animation),</span><br><span class="line">      duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">300</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Widget _buildItem(<span class="built_in">String</span> item, Animation&lt;<span class="built_in">double</span>&gt; animation) &#123;</span><br><span class="line">    <span class="keyword">return</span> SlideTransition(</span><br><span class="line">      position: animation.drive(</span><br><span class="line">        Tween&lt;Offset&gt;(</span><br><span class="line">          begin: <span class="keyword">const</span> Offset(<span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">          end: Offset.zero,</span><br><span class="line">        ).chain(CurveTween(curve: Curves.easeOut)),</span><br><span class="line">      ),</span><br><span class="line">      child: Card(</span><br><span class="line">        margin: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">16</span>, vertical: <span class="number">4</span>),</span><br><span class="line">        child: ListTile(</span><br><span class="line">          title: Text(item),</span><br><span class="line">          trailing: IconButton(</span><br><span class="line">            icon: <span class="keyword">const</span> Icon(Icons.delete),</span><br><span class="line">            onPressed: () =&gt; _removeItem(_items.indexOf(item)),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: [</span><br><span class="line">        ElevatedButton(</span><br><span class="line">          onPressed: _addItem,</span><br><span class="line">          child: <span class="keyword">const</span> Text(<span class="string">&#x27;添加项目&#x27;</span>),</span><br><span class="line">        ),</span><br><span class="line">        Expanded(</span><br><span class="line">          child: AnimatedList(</span><br><span class="line">            key: _listKey,</span><br><span class="line">            initialItemCount: _items.length,</span><br><span class="line">            itemBuilder: (context, index, animation) &#123;</span><br><span class="line">              <span class="keyword">return</span> _buildItem(_items[index], animation);</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="页面转场动画优化"><a href="#页面转场动画优化" class="headerlink" title="页面转场动画优化"></a>页面转场动画优化</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 自定义页面转场动画，提升用户体验</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomPageRoute</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">PageRouteBuilder</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget child;</span><br><span class="line">  <span class="keyword">final</span> AxisDirection direction;</span><br><span class="line">  </span><br><span class="line">  CustomPageRoute(&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.child,</span><br><span class="line">    <span class="keyword">this</span>.direction = AxisDirection.right,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(</span><br><span class="line">    transitionDuration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">300</span>),</span><br><span class="line">    reverseTransitionDuration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">300</span>),</span><br><span class="line">    pageBuilder: (context, animation, secondaryAnimation) =&gt; child,</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget buildTransitions(</span><br><span class="line">    BuildContext context,</span><br><span class="line">    Animation&lt;<span class="built_in">double</span>&gt; animation,</span><br><span class="line">    Animation&lt;<span class="built_in">double</span>&gt; secondaryAnimation,</span><br><span class="line">    Widget child,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> SlideTransition(</span><br><span class="line">      position: animation.drive(</span><br><span class="line">        Tween&lt;Offset&gt;(</span><br><span class="line">          begin: _getBeginOffset(),</span><br><span class="line">          end: Offset.zero,</span><br><span class="line">        ).chain(CurveTween(curve: Curves.easeInOut)),</span><br><span class="line">      ),</span><br><span class="line">      child: child,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Offset _getBeginOffset() &#123;</span><br><span class="line">    <span class="keyword">switch</span> (direction) &#123;</span><br><span class="line">      <span class="keyword">case</span> AxisDirection.up:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">const</span> Offset(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">case</span> AxisDirection.down:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">const</span> Offset(<span class="number">0</span>, <span class="number">-1</span>);</span><br><span class="line">      <span class="keyword">case</span> AxisDirection.left:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">const</span> Offset(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">case</span> AxisDirection.right:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">const</span> Offset(<span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NavigationExample</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ElevatedButton(</span><br><span class="line">      onPressed: () &#123;</span><br><span class="line">        Navigator.of(context).push(</span><br><span class="line">          CustomPageRoute(</span><br><span class="line">            child: <span class="keyword">const</span> NextPage(),</span><br><span class="line">            direction: AxisDirection.left,</span><br><span class="line">          ),</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">      child: <span class="keyword">const</span> Text(<span class="string">&#x27;自定义转场&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="动画性能监控"><a href="#动画性能监控" class="headerlink" title="动画性能监控"></a>动画性能监控</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🔥 动画性能监控工具</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimationPerformanceMonitor</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> monitorAnimation(AnimationController controller, <span class="built_in">String</span> name) &#123;</span><br><span class="line">    controller.addListener(() &#123;</span><br><span class="line">      <span class="comment">// 监控动画帧率</span></span><br><span class="line">      <span class="keyword">final</span> fps = <span class="number">1000</span> / (<span class="built_in">DateTime</span>.now().millisecondsSinceEpoch % <span class="number">1000</span>);</span><br><span class="line">      <span class="keyword">if</span> (fps &lt; <span class="number">50</span>) &#123; <span class="comment">// 低于50fps时警告</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;⚠️ 动画性能警告: <span class="subst">$name</span> 当前帧率: <span class="subst">$&#123;fps.toStringAsFixed(<span class="number">1</span>)&#125;</span> FPS&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    controller.addStatusListener((status) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;📊 动画状态变化: <span class="subst">$name</span> -&gt; <span class="subst">$status</span>&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 批量监控多个动画控制器</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> monitorMultipleAnimations(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, AnimationController&gt; controllers) &#123;</span><br><span class="line">    controllers.forEach((name, controller) &#123;</span><br><span class="line">      monitorAnimation(controller, name);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="项目优化建议"><a href="#项目优化建议" class="headerlink" title="项目优化建议"></a>项目优化建议</h2><h3 id="1-代码结构优化"><a href="#1-代码结构优化" class="headerlink" title="1. 代码结构优化"></a>1. 代码结构优化</h3><h4 id="按功能模块组织代码"><a href="#按功能模块组织代码" class="headerlink" title="按功能模块组织代码"></a>按功能模块组织代码</h4><pre><code>lib/
├── core/                 # 核心功能
│   ├── constants/       # 常量定义
│   ├── utils/          # 工具类
│   └── services/       # 服务类
├── features/           # 功能模块
│   ├── auth/          # 认证模块
│   │   ├── data/      # 数据层
│   │   ├── domain/    # 业务逻辑层
│   │   └── presentation/ # 表现层
│   └── home/          # 首页模块
├── shared/            # 共享组件
│   ├── widgets/       # 通用 Widget
│   └── themes/        # 主题配置
└── main.dart
</code></pre>
<h4 id="使用依赖注入"><a href="#使用依赖注入" class="headerlink" title="使用依赖注入"></a>使用依赖注入</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🏗️ 使用 get_it 进行依赖注入管理</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:get_it/get_it.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务定位器 - 全局依赖管理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServiceLocator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> GetIt _getIt = GetIt.instance;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 初始化所有依赖</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="keyword">void</span>&gt; setup() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🚀 开始初始化依赖注入...&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册核心服务（单例模式）</span></span><br><span class="line">    _getIt.registerLazySingleton&lt;ApiService&gt;(() &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;📡 创建 ApiService 实例&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> ApiService();</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    _getIt.registerLazySingleton&lt;DatabaseService&gt;(() &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;💾 创建 DatabaseService 实例&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> DatabaseService();</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    _getIt.registerLazySingleton&lt;CacheService&gt;(() &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;🗄️ 创建 CacheService 实例&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> CacheService();</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册 Repository 层（依赖注入）</span></span><br><span class="line">    _getIt.registerLazySingleton&lt;UserRepository&gt;(</span><br><span class="line">      () =&gt; UserRepositoryImpl(</span><br><span class="line">        apiService: _getIt&lt;ApiService&gt;(),</span><br><span class="line">        cacheService: _getIt&lt;CacheService&gt;(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    _getIt.registerLazySingleton&lt;ProductRepository&gt;(</span><br><span class="line">      () =&gt; ProductRepositoryImpl(</span><br><span class="line">        apiService: _getIt&lt;ApiService&gt;(),</span><br><span class="line">        databaseService: _getIt&lt;DatabaseService&gt;(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册业务逻辑层（Use Cases）</span></span><br><span class="line">    _getIt.registerFactory&lt;LoginUseCase&gt;(</span><br><span class="line">      () =&gt; LoginUseCase(_getIt&lt;UserRepository&gt;()),</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    _getIt.registerFactory&lt;GetProductsUseCase&gt;(</span><br><span class="line">      () =&gt; GetProductsUseCase(_getIt&lt;ProductRepository&gt;()),</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册状态管理（Provider/BLoC）</span></span><br><span class="line">    _getIt.registerFactory&lt;AuthProvider&gt;(</span><br><span class="line">      () =&gt; AuthProvider(_getIt&lt;LoginUseCase&gt;()),</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;✅ 依赖注入初始化完成&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取依赖实例</span></span><br><span class="line">  <span class="keyword">static</span> T <span class="keyword">get</span>&lt;T <span class="keyword">extends</span> <span class="built_in">Object</span>&gt;() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> _getIt.<span class="keyword">get</span>&lt;T&gt;();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;❌ 获取依赖失败: <span class="subst">$T</span> - <span class="subst">$e</span>&#x27;</span>);</span><br><span class="line">      <span class="keyword">rethrow</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 检查依赖是否已注册</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">bool</span> isRegistered&lt;T <span class="keyword">extends</span> <span class="built_in">Object</span>&gt;() &#123;</span><br><span class="line">    <span class="keyword">return</span> _getIt.isRegistered&lt;T&gt;();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 重置所有依赖（主要用于测试）</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="keyword">void</span>&gt; reset() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> _getIt.reset();</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🔄 依赖注入已重置&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例 - 在 Widget 中获取依赖</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfileWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// 通过依赖注入获取服务</span></span><br><span class="line">    <span class="keyword">final</span> userRepository = ServiceLocator.<span class="keyword">get</span>&lt;UserRepository&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> FutureBuilder&lt;User&gt;(</span><br><span class="line">      future: userRepository.getCurrentUser(),</span><br><span class="line">      builder: (context, snapshot) &#123;</span><br><span class="line">        <span class="keyword">if</span> (snapshot.hasData) &#123;</span><br><span class="line">          <span class="keyword">return</span> Text(<span class="string">&#x27;用户: <span class="subst">$&#123;snapshot.data!.name&#125;</span>&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">const</span> CircularProgressIndicator();</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用启动时初始化</span></span><br><span class="line"><span class="keyword">void</span> main() <span class="keyword">async</span> &#123;</span><br><span class="line">  WidgetsFlutterBinding.ensureInitialized();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 初始化依赖注入</span></span><br><span class="line">  <span class="keyword">await</span> ServiceLocator.setup();</span><br><span class="line">  </span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Clean-Architecture-实现"><a href="#Clean-Architecture-实现" class="headerlink" title="Clean Architecture 实现"></a>Clean Architecture 实现</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🏛️ Clean Architecture 分层实现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Domain Layer - 业务实体</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> id;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> name;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> email;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">DateTime</span> createdAt;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> User(&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.id,</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.name,</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.email,</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.createdAt,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Domain Layer - Repository 接口</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRepository</span> </span>&#123;</span><br><span class="line">  Future&lt;User&gt; getUserById(<span class="built_in">String</span> id);</span><br><span class="line">  Future&lt;<span class="built_in">List</span>&lt;User&gt;&gt; getAllUsers();</span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; saveUser(User user);</span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; deleteUser(<span class="built_in">String</span> id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Domain Layer - Use Case</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetUserUseCase</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> UserRepository _repository;</span><br><span class="line">  </span><br><span class="line">  GetUserUseCase(<span class="keyword">this</span>._repository);</span><br><span class="line">  </span><br><span class="line">  Future&lt;User&gt; execute(<span class="built_in">String</span> userId) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🔍 执行获取用户用例: <span class="subst">$userId</span>&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> user = <span class="keyword">await</span> _repository.getUserById(userId);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 用户获取成功: <span class="subst">$&#123;user.name&#125;</span>&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> user;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;❌ 用户获取失败: <span class="subst">$e</span>&#x27;</span>);</span><br><span class="line">      <span class="keyword">rethrow</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Data Layer - Repository 实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRepositoryImpl</span> <span class="keyword">implements</span> <span class="title">UserRepository</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> ApiService _apiService;</span><br><span class="line">  <span class="keyword">final</span> CacheService _cacheService;</span><br><span class="line">  </span><br><span class="line">  UserRepositoryImpl(&#123;</span><br><span class="line">    <span class="keyword">required</span> ApiService apiService,</span><br><span class="line">    <span class="keyword">required</span> CacheService cacheService,</span><br><span class="line">  &#125;) : _apiService = apiService,</span><br><span class="line">       _cacheService = cacheService;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;User&gt; getUserById(<span class="built_in">String</span> id) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="comment">// 先检查缓存</span></span><br><span class="line">    <span class="keyword">final</span> cachedUser = <span class="keyword">await</span> _cacheService.getUser(id);</span><br><span class="line">    <span class="keyword">if</span> (cachedUser != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;📦 从缓存获取用户: <span class="subst">$id</span>&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> cachedUser;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 从网络获取</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🌐 从网络获取用户: <span class="subst">$id</span>&#x27;</span>);</span><br><span class="line">    <span class="keyword">final</span> userData = <span class="keyword">await</span> _apiService.getUser(id);</span><br><span class="line">    <span class="keyword">final</span> user = User(</span><br><span class="line">      id: userData[<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">      name: userData[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">      email: userData[<span class="string">&#x27;email&#x27;</span>],</span><br><span class="line">      createdAt: <span class="built_in">DateTime</span>.parse(userData[<span class="string">&#x27;created_at&#x27;</span>]),</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 缓存结果</span></span><br><span class="line">    <span class="keyword">await</span> _cacheService.saveUser(user);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;<span class="built_in">List</span>&lt;User&gt;&gt; getAllUsers() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="comment">// 实现获取所有用户的逻辑</span></span><br><span class="line">    <span class="keyword">final</span> usersData = <span class="keyword">await</span> _apiService.getAllUsers();</span><br><span class="line">    <span class="keyword">return</span> usersData.map&lt;User&gt;((data) =&gt; User(</span><br><span class="line">      id: data[<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">      name: data[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">      email: data[<span class="string">&#x27;email&#x27;</span>],</span><br><span class="line">      createdAt: <span class="built_in">DateTime</span>.parse(data[<span class="string">&#x27;created_at&#x27;</span>]),</span><br><span class="line">    )).toList();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; saveUser(User user) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> _apiService.saveUser(&#123;</span><br><span class="line">      <span class="string">&#x27;id&#x27;</span>: user.id,</span><br><span class="line">      <span class="string">&#x27;name&#x27;</span>: user.name,</span><br><span class="line">      <span class="string">&#x27;email&#x27;</span>: user.email,</span><br><span class="line">      <span class="string">&#x27;created_at&#x27;</span>: user.createdAt.toIso8601String(),</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新缓存</span></span><br><span class="line">    <span class="keyword">await</span> _cacheService.saveUser(user);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; deleteUser(<span class="built_in">String</span> id) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> _apiService.deleteUser(id);</span><br><span class="line">    <span class="keyword">await</span> _cacheService.removeUser(id);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Presentation Layer - Provider</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProvider</span> <span class="keyword">extends</span> <span class="title">ChangeNotifier</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> GetUserUseCase _getUserUseCase;</span><br><span class="line">  </span><br><span class="line">  User? _currentUser;</span><br><span class="line">  <span class="built_in">bool</span> _isLoading = <span class="keyword">false</span>;</span><br><span class="line">  <span class="built_in">String?</span> _error;</span><br><span class="line">  </span><br><span class="line">  UserProvider(<span class="keyword">this</span>._getUserUseCase);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Getters</span></span><br><span class="line">  User? <span class="keyword">get</span> currentUser =&gt; _currentUser;</span><br><span class="line">  <span class="built_in">bool</span> <span class="keyword">get</span> isLoading =&gt; _isLoading;</span><br><span class="line">  <span class="built_in">String?</span> <span class="keyword">get</span> error =&gt; _error;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 加载用户</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; loadUser(<span class="built_in">String</span> userId) <span class="keyword">async</span> &#123;</span><br><span class="line">    _setLoading(<span class="keyword">true</span>);</span><br><span class="line">    _setError(<span class="keyword">null</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> user = <span class="keyword">await</span> _getUserUseCase.execute(userId);</span><br><span class="line">      _currentUser = user;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      _setError(e.toString());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      _setLoading(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _setLoading(<span class="built_in">bool</span> loading) &#123;</span><br><span class="line">    _isLoading = loading;</span><br><span class="line">    notifyListeners();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _setError(<span class="built_in">String?</span> error) &#123;</span><br><span class="line">    _error = error;</span><br><span class="line">    notifyListeners();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-内存管理"><a href="#2-内存管理" class="headerlink" title="2. 内存管理"></a>2. 内存管理</h3><h4 id="正确处理资源释放"><a href="#正确处理资源释放" class="headerlink" title="正确处理资源释放"></a>正确处理资源释放</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🧹 完整的资源管理示例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResourceManagementWidget</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _ResourceManagementWidgetState createState() =&gt; </span><br><span class="line">      _ResourceManagementWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_ResourceManagementWidgetState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">ResourceManagementWidget</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 需要手动释放的资源</span></span><br><span class="line">  <span class="keyword">late</span> StreamSubscription _dataSubscription;</span><br><span class="line">  <span class="keyword">late</span> StreamSubscription _connectivitySubscription;</span><br><span class="line">  <span class="keyword">late</span> Timer _periodicTimer;</span><br><span class="line">  <span class="keyword">late</span> AnimationController _animationController;</span><br><span class="line">  <span class="keyword">final</span> TextEditingController _textController = TextEditingController();</span><br><span class="line">  <span class="keyword">final</span> ScrollController _scrollController = ScrollController();</span><br><span class="line">  <span class="keyword">final</span> FocusNode _focusNode = FocusNode();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 流控制器</span></span><br><span class="line">  <span class="keyword">final</span> StreamController&lt;<span class="built_in">String</span>&gt; _messageController = StreamController&lt;<span class="built_in">String</span>&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _initializeResources();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _initializeResources() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🚀 初始化资源...&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化动画控制器</span></span><br><span class="line">    _animationController = AnimationController(</span><br><span class="line">      duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">2</span>),</span><br><span class="line">      vsync: <span class="keyword">this</span>,</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 订阅数据流</span></span><br><span class="line">    _dataSubscription = _createDataStream().listen(</span><br><span class="line">      (data) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;📊 接收到数据: <span class="subst">$data</span>&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (mounted) &#123; <span class="comment">// 检查 Widget 是否仍然挂载</span></span><br><span class="line">          setState(() &#123;</span><br><span class="line">            <span class="comment">// 更新UI</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      onError: (error) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;❌ 数据流错误: <span class="subst">$error</span>&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      onDone: () &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;✅ 数据流完成&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听网络连接状态</span></span><br><span class="line">    _connectivitySubscription = Connectivity().onConnectivityChanged.listen(</span><br><span class="line">      (ConnectivityResult result) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;🌐 网络状态变化: <span class="subst">$result</span>&#x27;</span>);</span><br><span class="line">        _handleConnectivityChange(result);</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建周期性定时器</span></span><br><span class="line">    _periodicTimer = Timer.periodic(</span><br><span class="line">      <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">5</span>),</span><br><span class="line">      (timer) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mounted) &#123;</span><br><span class="line">          _performPeriodicTask();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          timer.cancel(); <span class="comment">// 如果Widget已销毁，取消定时器</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听滚动事件</span></span><br><span class="line">    _scrollController.addListener(_onScroll);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听焦点变化</span></span><br><span class="line">    _focusNode.addListener(_onFocusChange);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;✅ 资源初始化完成&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 创建数据流</span></span><br><span class="line">  Stream&lt;<span class="built_in">String</span>&gt; _createDataStream() &#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.periodic(</span><br><span class="line">      <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">2</span>),</span><br><span class="line">      (count) =&gt; <span class="string">&#x27;Data <span class="subst">$count</span>&#x27;</span>,</span><br><span class="line">    ).take(<span class="number">10</span>); <span class="comment">// 限制流的数量，避免无限流</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _handleConnectivityChange(ConnectivityResult result) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (result) &#123;</span><br><span class="line">      <span class="keyword">case</span> ConnectivityResult.wifi:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;📶 已连接到WiFi&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> ConnectivityResult.mobile:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;📱 已连接到移动网络&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> ConnectivityResult.none:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;🚫 网络连接断开&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;❓ 未知网络状态&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _performPeriodicTask() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;⏰ 执行周期性任务: <span class="subst">$&#123;DateTime.now()&#125;</span>&#x27;</span>);</span><br><span class="line">    <span class="comment">// 执行定期任务，如数据同步、状态检查等</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _onScroll() &#123;</span><br><span class="line">    <span class="comment">// 滚动监听逻辑</span></span><br><span class="line">    <span class="keyword">if</span> (_scrollController.position.pixels &gt; <span class="number">100</span>) &#123;</span><br><span class="line">      <span class="comment">// 滚动超过100像素时的处理</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _onFocusChange() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_focusNode.hasFocus) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;🎯 输入框获得焦点&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;🎯 输入框失去焦点&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🧹 开始释放资源...&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 释放订阅（按照创建的逆序释放）</span></span><br><span class="line">    _dataSubscription.cancel();</span><br><span class="line">    _connectivitySubscription.cancel();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 释放定时器</span></span><br><span class="line">    _periodicTimer.cancel();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 释放动画控制器</span></span><br><span class="line">    _animationController.dispose();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 释放控制器</span></span><br><span class="line">    _textController.dispose();</span><br><span class="line">    _scrollController.dispose();</span><br><span class="line">    _focusNode.dispose();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 关闭流控制器</span></span><br><span class="line">    _messageController.close();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;✅ 资源释放完成&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Column(</span><br><span class="line">        children: [</span><br><span class="line">          <span class="comment">// 输入框</span></span><br><span class="line">          TextField(</span><br><span class="line">            controller: _textController,</span><br><span class="line">            focusNode: _focusNode,</span><br><span class="line">            decoration: <span class="keyword">const</span> InputDecoration(</span><br><span class="line">              hintText: <span class="string">&#x27;请输入内容&#x27;</span>,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// 可滚动列表</span></span><br><span class="line">          Expanded(</span><br><span class="line">            child: ListView.builder(</span><br><span class="line">              controller: _scrollController,</span><br><span class="line">              itemCount: <span class="number">100</span>,</span><br><span class="line">              itemBuilder: (context, index) &#123;</span><br><span class="line">                <span class="keyword">return</span> ListTile(</span><br><span class="line">                  title: Text(<span class="string">&#x27;Item <span class="subst">$index</span>&#x27;</span>),</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// 动画按钮</span></span><br><span class="line">          AnimatedBuilder(</span><br><span class="line">            animation: _animationController,</span><br><span class="line">            builder: (context, child) &#123;</span><br><span class="line">              <span class="keyword">return</span> Transform.scale(</span><br><span class="line">                scale: <span class="number">1.0</span> + _animationController.value * <span class="number">0.1</span>,</span><br><span class="line">                child: ElevatedButton(</span><br><span class="line">                  onPressed: () &#123;</span><br><span class="line">                    <span class="keyword">if</span> (_animationController.isCompleted) &#123;</span><br><span class="line">                      _animationController.reverse();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                      _animationController.forward();</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  child: <span class="keyword">const</span> Text(<span class="string">&#x27;动画按钮&#x27;</span>),</span><br><span class="line">                ),</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="内存泄漏检测和预防"><a href="#内存泄漏检测和预防" class="headerlink" title="内存泄漏检测和预防"></a>内存泄漏检测和预防</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🔍 内存泄漏检测工具</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MemoryLeakDetector</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">int</span>&gt; _widgetCounts = &#123;&#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 注册Widget创建</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> registerWidget(<span class="built_in">String</span> widgetName) &#123;</span><br><span class="line">    _widgetCounts[widgetName] = (_widgetCounts[widgetName] ?? <span class="number">0</span>) + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;📈 Widget创建: <span class="subst">$widgetName</span> (总数: <span class="subst">$&#123;_widgetCounts[widgetName]&#125;</span>)&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 注册Widget销毁</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> unregisterWidget(<span class="built_in">String</span> widgetName) &#123;</span><br><span class="line">    <span class="keyword">if</span> (_widgetCounts.containsKey(widgetName)) &#123;</span><br><span class="line">      _widgetCounts[widgetName] = _widgetCounts[widgetName]! - <span class="number">1</span>;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;📉 Widget销毁: <span class="subst">$widgetName</span> (剩余: <span class="subst">$&#123;_widgetCounts[widgetName]&#125;</span>)&#x27;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (_widgetCounts[widgetName]! &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        _widgetCounts.remove(widgetName);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 打印内存使用报告</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> printMemoryReport() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n📊 内存使用报告:&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (_widgetCounts.isEmpty) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 没有检测到内存泄漏&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _widgetCounts.forEach((widget, count) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;⚠️ <span class="subst">$widget</span>: <span class="subst">$count</span> 个实例未释放&#x27;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用内存检测的Widget基类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TrackedStatefulWidget</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> TrackedStatefulWidget(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  TrackedState createState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TrackedState</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">TrackedStatefulWidget</span>&gt; <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    MemoryLeakDetector.registerWidget(runtimeType.toString());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    MemoryLeakDetector.unregisterWidget(runtimeType.toString());</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTrackedWidget</span> <span class="keyword">extends</span> <span class="title">TrackedStatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyTrackedWidgetState createState() =&gt; _MyTrackedWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyTrackedWidgetState</span> <span class="keyword">extends</span> <span class="title">TrackedState</span>&lt;<span class="title">MyTrackedWidget</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      child: Text(<span class="string">&#x27;被跟踪的Widget&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="大数据集合优化"><a href="#大数据集合优化" class="headerlink" title="大数据集合优化"></a>大数据集合优化</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🗂️ 大数据集合的内存优化</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptimizedDataManager</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 使用弱引用缓存，避免内存泄漏</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, WeakReference&lt;<span class="built_in">dynamic</span>&gt;&gt; _cache = &#123;&#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 分页数据管理</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">int</span>, <span class="built_in">List</span>&lt;<span class="built_in">dynamic</span>&gt;&gt; _pageCache = &#123;&#125;;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> _pageSize = <span class="number">50</span>;</span><br><span class="line">  <span class="built_in">int</span> _maxCachedPages = <span class="number">10</span>; <span class="comment">// 最多缓存10页数据</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取分页数据</span></span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">dynamic</span>&gt; getPageData(<span class="built_in">int</span> page) &#123;</span><br><span class="line">    <span class="comment">// 检查缓存</span></span><br><span class="line">    <span class="keyword">if</span> (_pageCache.containsKey(page)) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;📦 从缓存获取第<span class="subst">$&#123;page&#125;</span>页数据&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> _pageCache[page]!;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 模拟加载数据</span></span><br><span class="line">    <span class="keyword">final</span> data = _loadPageData(page);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 缓存数据，但限制缓存大小</span></span><br><span class="line">    _cachePageData(page, data);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">dynamic</span>&gt; _loadPageData(<span class="built_in">int</span> page) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🌐 加载第<span class="subst">$&#123;page&#125;</span>页数据&#x27;</span>);</span><br><span class="line">    <span class="comment">// 模拟数据加载</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">List</span>.generate(_pageSize, (index) =&gt; &#123;</span><br><span class="line">      <span class="string">&#x27;id&#x27;</span>: page * _pageSize + index,</span><br><span class="line">      <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;Item <span class="subst">$&#123;page * _pageSize + index&#125;</span>&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;data&#x27;</span>: <span class="string">&#x27;Some data for item <span class="subst">$&#123;page * _pageSize + index&#125;</span>&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> _cachePageData(<span class="built_in">int</span> page, <span class="built_in">List</span>&lt;<span class="built_in">dynamic</span>&gt; data) &#123;</span><br><span class="line">    <span class="comment">// 如果缓存已满，移除最旧的页面</span></span><br><span class="line">    <span class="keyword">if</span> (_pageCache.length &gt;= _maxCachedPages) &#123;</span><br><span class="line">      <span class="keyword">final</span> oldestPage = _pageCache.keys.first;</span><br><span class="line">      _pageCache.remove(oldestPage);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;🗑️ 移除缓存页面: <span class="subst">$oldestPage</span>&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _pageCache[page] = data;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;💾 缓存第<span class="subst">$&#123;page&#125;</span>页数据&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 清理缓存</span></span><br><span class="line">  <span class="keyword">void</span> clearCache() &#123;</span><br><span class="line">    _pageCache.clear();</span><br><span class="line">    _cache.clear();</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🧹 缓存已清理&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取缓存统计信息</span></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; getCacheStats() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&#x27;cached_pages&#x27;</span>: _pageCache.length,</span><br><span class="line">      <span class="string">&#x27;cache_size_mb&#x27;</span>: _estimateCacheSize(),</span><br><span class="line">      <span class="string">&#x27;max_pages&#x27;</span>: _maxCachedPages,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">double</span> _estimateCacheSize() &#123;</span><br><span class="line">    <span class="comment">// 简单估算缓存大小（实际应用中可以更精确）</span></span><br><span class="line">    <span class="built_in">int</span> totalItems = _pageCache.values.fold(<span class="number">0</span>, (sum, page) =&gt; sum + page.length);</span><br><span class="line">    <span class="keyword">return</span> totalItems * <span class="number">0.001</span>; <span class="comment">// 假设每个项目约1KB</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-网络请求优化"><a href="#3-网络请求优化" class="headerlink" title="3. 网络请求优化"></a>3. 网络请求优化</h3><h4 id="实现请求缓存和重试机制"><a href="#实现请求缓存和重试机制" class="headerlink" title="实现请求缓存和重试机制"></a>实现请求缓存和重试机制</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🌐 完整的网络服务管理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkService</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> Dio _dio = Dio();</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, CacheItem&gt; _cache = &#123;&#125;;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, Completer&lt;<span class="built_in">dynamic</span>&gt;&gt; _pendingRequests = &#123;&#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 缓存配置</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">int</span> _defaultCacheDuration = <span class="number">300</span>; <span class="comment">// 5分钟</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">int</span> _maxCacheSize = <span class="number">100</span>; <span class="comment">// 最大缓存条目数</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> initialize() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🚀 初始化网络服务...&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 配置拦截器</span></span><br><span class="line">    _dio.interceptors.add(</span><br><span class="line">      InterceptorsWrapper(</span><br><span class="line">        onRequest: (options, handler) &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;📤 发送请求: <span class="subst">$&#123;options.method&#125;</span> <span class="subst">$&#123;options.uri&#125;</span>&#x27;</span>);</span><br><span class="line">          <span class="comment">// 添加通用请求头</span></span><br><span class="line">          options.headers[<span class="string">&#x27;User-Agent&#x27;</span>] = <span class="string">&#x27;Flutter App&#x27;</span>;</span><br><span class="line">          options.headers[<span class="string">&#x27;Accept&#x27;</span>] = <span class="string">&#x27;application/json&#x27;</span>;</span><br><span class="line">          handler.next(options);</span><br><span class="line">        &#125;,</span><br><span class="line">        onResponse: (response, handler) &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;📥 收到响应: <span class="subst">$&#123;response.statusCode&#125;</span> <span class="subst">$&#123;response.requestOptions.uri&#125;</span>&#x27;</span>);</span><br><span class="line">          handler.next(response);</span><br><span class="line">        &#125;,</span><br><span class="line">        onError: (error, handler) &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;❌ 请求错误: <span class="subst">$&#123;error.message&#125;</span>&#x27;</span>);</span><br><span class="line">          handler.next(error);</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 配置超时</span></span><br><span class="line">    _dio.options.connectTimeout = <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">10</span>);</span><br><span class="line">    _dio.options.receiveTimeout = <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">30</span>);</span><br><span class="line">    _dio.options.sendTimeout = <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">30</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;✅ 网络服务初始化完成&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通用请求方法</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;T&gt; request&lt;T&gt;(</span><br><span class="line">    <span class="built_in">String</span> url, &#123;</span><br><span class="line">    <span class="built_in">String</span> method = <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;? params,</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;? data,</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt;? headers,</span><br><span class="line">    <span class="built_in">bool</span> useCache = <span class="keyword">true</span>,</span><br><span class="line">    <span class="built_in">int</span> cacheDuration = _defaultCacheDuration,</span><br><span class="line">    <span class="built_in">int</span> retryCount = <span class="number">3</span>,</span><br><span class="line">    <span class="built_in">Duration</span> retryDelay = <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">1</span>),</span><br><span class="line">  &#125;) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> cacheKey = _generateCacheKey(url, method, params, data);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查缓存</span></span><br><span class="line">    <span class="keyword">if</span> (useCache &amp;&amp; method == <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">final</span> cachedResult = _getFromCache&lt;T&gt;(cacheKey);</span><br><span class="line">      <span class="keyword">if</span> (cachedResult != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;📦 从缓存获取: <span class="subst">$url</span>&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> cachedResult;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查是否有相同的请求正在进行</span></span><br><span class="line">    <span class="keyword">if</span> (_pendingRequests.containsKey(cacheKey)) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;⏳ 等待相同请求完成: <span class="subst">$url</span>&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> _pendingRequests[cacheKey]!.future;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建请求完成器</span></span><br><span class="line">    <span class="keyword">final</span> completer = Completer&lt;T&gt;();</span><br><span class="line">    _pendingRequests[cacheKey] = completer;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> result = <span class="keyword">await</span> _executeRequestWithRetry&lt;T&gt;(</span><br><span class="line">        url,</span><br><span class="line">        method: method,</span><br><span class="line">        params: params,</span><br><span class="line">        data: data,</span><br><span class="line">        headers: headers,</span><br><span class="line">        retryCount: retryCount,</span><br><span class="line">        retryDelay: retryDelay,</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 缓存GET请求结果</span></span><br><span class="line">      <span class="keyword">if</span> (useCache &amp;&amp; method == <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">        _saveToCache(cacheKey, result, cacheDuration);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      completer.complete(result);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      completer.completeError(error);</span><br><span class="line">      <span class="keyword">rethrow</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      _pendingRequests.remove(cacheKey);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 执行带重试的请求</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;T&gt; _executeRequestWithRetry&lt;T&gt;(</span><br><span class="line">    <span class="built_in">String</span> url, &#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="built_in">String</span> method,</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;? params,</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;? data,</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt;? headers,</span><br><span class="line">    <span class="keyword">required</span> <span class="built_in">int</span> retryCount,</span><br><span class="line">    <span class="keyword">required</span> <span class="built_in">Duration</span> retryDelay,</span><br><span class="line">  &#125;) <span class="keyword">async</span> &#123;</span><br><span class="line">    Exception? lastException;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> attempt = <span class="number">1</span>; attempt &lt;= retryCount; attempt++) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;🔄 尝试请求 (<span class="subst">$attempt</span>/<span class="subst">$retryCount</span>): <span class="subst">$url</span>&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">final</span> options = Options(</span><br><span class="line">          method: method,</span><br><span class="line">          headers: headers,</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        Response response;</span><br><span class="line">        <span class="keyword">switch</span> (method.toUpperCase()) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">            response = <span class="keyword">await</span> _dio.<span class="keyword">get</span>(url, queryParameters: params, options: options);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">            response = <span class="keyword">await</span> _dio.post(url, data: data, queryParameters: params, options: options);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;PUT&#x27;</span>:</span><br><span class="line">            response = <span class="keyword">await</span> _dio.put(url, data: data, queryParameters: params, options: options);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;DELETE&#x27;</span>:</span><br><span class="line">            response = <span class="keyword">await</span> _dio.delete(url, data: data, queryParameters: params, options: options);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> UnsupportedError(<span class="string">&#x27;不支持的HTTP方法: <span class="subst">$method</span>&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查响应状态</span></span><br><span class="line">        <span class="keyword">if</span> (response.statusCode! &gt;= <span class="number">200</span> &amp;&amp; response.statusCode! &lt; <span class="number">300</span>) &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;✅ 请求成功: <span class="subst">$url</span>&#x27;</span>);</span><br><span class="line">          <span class="keyword">return</span> response.data;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> HttpException(<span class="string">&#x27;HTTP <span class="subst">$&#123;response.statusCode&#125;</span>: <span class="subst">$&#123;response.statusMessage&#125;</span>&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">on</span> DioException <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        lastException = _handleDioException(e);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果是最后一次尝试，直接抛出异常</span></span><br><span class="line">        <span class="keyword">if</span> (attempt == retryCount) &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;❌ 请求最终失败: <span class="subst">$url</span>&#x27;</span>);</span><br><span class="line">          <span class="keyword">throw</span> lastException;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 根据错误类型决定是否重试</span></span><br><span class="line">        <span class="keyword">if</span> (!_shouldRetry(e)) &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;🚫 错误不可重试: <span class="subst">$&#123;e.type&#125;</span>&#x27;</span>);</span><br><span class="line">          <span class="keyword">throw</span> lastException;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 等待后重试</span></span><br><span class="line">        <span class="keyword">final</span> delay = retryDelay * attempt; <span class="comment">// 指数退避</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;⏰ <span class="subst">$&#123;delay.inSeconds&#125;</span>秒后重试...&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> Future.delayed(delay);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        lastException = Exception(<span class="string">&#x27;未知错误: <span class="subst">$e</span>&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (attempt == retryCount) &#123;</span><br><span class="line">          <span class="keyword">throw</span> lastException;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">await</span> Future.delayed(retryDelay * attempt);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">throw</span> lastException ?? Exception(<span class="string">&#x27;请求失败&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理Dio异常</span></span><br><span class="line">  <span class="keyword">static</span> Exception _handleDioException(DioException e) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (e.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.connectionTimeout:</span><br><span class="line">        <span class="keyword">return</span> TimeoutException(<span class="string">&#x27;连接超时&#x27;</span>, <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">10</span>));</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.sendTimeout:</span><br><span class="line">        <span class="keyword">return</span> TimeoutException(<span class="string">&#x27;发送超时&#x27;</span>, <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">30</span>));</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.receiveTimeout:</span><br><span class="line">        <span class="keyword">return</span> TimeoutException(<span class="string">&#x27;接收超时&#x27;</span>, <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">30</span>));</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.badResponse:</span><br><span class="line">        <span class="keyword">return</span> HttpException(<span class="string">&#x27;服务器错误: <span class="subst">$&#123;e.response?.statusCode&#125;</span>&#x27;</span>);</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.cancel:</span><br><span class="line">        <span class="keyword">return</span> Exception(<span class="string">&#x27;请求被取消&#x27;</span>);</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.connectionError:</span><br><span class="line">        <span class="keyword">return</span> Exception(<span class="string">&#x27;网络连接错误&#x27;</span>);</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> Exception(<span class="string">&#x27;网络请求失败: <span class="subst">$&#123;e.message&#125;</span>&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 判断是否应该重试</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">bool</span> _shouldRetry(DioException e) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (e.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.connectionTimeout:</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.sendTimeout:</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.receiveTimeout:</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.connectionError:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">case</span> DioExceptionType.badResponse:</span><br><span class="line">        <span class="comment">// 5xx错误可以重试，4xx错误不重试</span></span><br><span class="line">        <span class="keyword">final</span> statusCode = e.response?.statusCode ?? <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> statusCode &gt;= <span class="number">500</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 生成缓存键</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">String</span> _generateCacheKey(</span><br><span class="line">    <span class="built_in">String</span> url,</span><br><span class="line">    <span class="built_in">String</span> method,</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;? params,</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;? data,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">final</span> buffer = <span class="built_in">StringBuffer</span>();</span><br><span class="line">    buffer.write(<span class="string">&#x27;<span class="subst">$method</span>:<span class="subst">$url</span>&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (params != <span class="keyword">null</span> &amp;&amp; params.isNotEmpty) &#123;</span><br><span class="line">      buffer.write(<span class="string">&#x27;?<span class="subst">$&#123;Uri(queryParameters: params.map((k, v) =&gt; MapEntry(k, v.toString()))).query&#125;</span>&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (data != <span class="keyword">null</span> &amp;&amp; data.isNotEmpty) &#123;</span><br><span class="line">      buffer.write(<span class="string">&#x27;#<span class="subst">$&#123;data.toString()&#125;</span>&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> buffer.toString();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 从缓存获取数据</span></span><br><span class="line">  <span class="keyword">static</span> T? _getFromCache&lt;T&gt;(<span class="built_in">String</span> key) &#123;</span><br><span class="line">    <span class="keyword">final</span> item = _cache[key];</span><br><span class="line">    <span class="keyword">if</span> (item != <span class="keyword">null</span> &amp;&amp; !item.isExpired) &#123;</span><br><span class="line">      <span class="keyword">return</span> item.data <span class="keyword">as</span> T;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 移除过期缓存</span></span><br><span class="line">    <span class="keyword">if</span> (item != <span class="keyword">null</span> &amp;&amp; item.isExpired) &#123;</span><br><span class="line">      _cache.remove(key);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;🗑️ 移除过期缓存: <span class="subst">$key</span>&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 保存到缓存</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> _saveToCache(<span class="built_in">String</span> key, <span class="built_in">dynamic</span> data, <span class="built_in">int</span> duration) &#123;</span><br><span class="line">    <span class="comment">// 检查缓存大小限制</span></span><br><span class="line">    <span class="keyword">if</span> (_cache.length &gt;= _maxCacheSize) &#123;</span><br><span class="line">      _cleanOldCache();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _cache[key] = CacheItem(</span><br><span class="line">      data: data,</span><br><span class="line">      expireTime: <span class="built_in">DateTime</span>.now().add(<span class="built_in">Duration</span>(seconds: duration)),</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;💾 保存到缓存: <span class="subst">$key</span> (<span class="subst">$&#123;duration&#125;</span>秒)&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 清理旧缓存</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> _cleanOldCache() &#123;</span><br><span class="line">    <span class="keyword">final</span> now = <span class="built_in">DateTime</span>.now();</span><br><span class="line">    <span class="keyword">final</span> expiredKeys = _cache.entries</span><br><span class="line">        .where((entry) =&gt; entry.value.expireTime.isBefore(now))</span><br><span class="line">        .map((entry) =&gt; entry.key)</span><br><span class="line">        .toList();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">final</span> key <span class="keyword">in</span> expiredKeys) &#123;</span><br><span class="line">      _cache.remove(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🧹 清理了 <span class="subst">$&#123;expiredKeys.length&#125;</span> 个过期缓存&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果还是太多，移除最旧的一半</span></span><br><span class="line">    <span class="keyword">if</span> (_cache.length &gt;= _maxCacheSize) &#123;</span><br><span class="line">      <span class="keyword">final</span> sortedEntries = _cache.entries.toList()</span><br><span class="line">        ..sort((a, b) =&gt; a.value.expireTime.compareTo(b.value.expireTime));</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">final</span> toRemove = sortedEntries.take(_cache.length ~/ <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">final</span> entry <span class="keyword">in</span> toRemove) &#123;</span><br><span class="line">        _cache.remove(entry.key);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;🗑️ 移除了 <span class="subst">$&#123;toRemove.length&#125;</span> 个旧缓存&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 清除所有缓存</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> clearCache() &#123;</span><br><span class="line">    _cache.clear();</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🧹 清除所有缓存&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取缓存统计信息</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; getCacheStats() &#123;</span><br><span class="line">    <span class="keyword">final</span> now = <span class="built_in">DateTime</span>.now();</span><br><span class="line">    <span class="keyword">final</span> validCount = _cache.values.where((item) =&gt; !item.isExpired).length;</span><br><span class="line">    <span class="keyword">final</span> expiredCount = _cache.length - validCount;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&#x27;total_cache_items&#x27;</span>: _cache.length,</span><br><span class="line">      <span class="string">&#x27;valid_cache_items&#x27;</span>: validCount,</span><br><span class="line">      <span class="string">&#x27;expired_cache_items&#x27;</span>: expiredCount,</span><br><span class="line">      <span class="string">&#x27;cache_hit_rate&#x27;</span>: <span class="string">&#x27;<span class="subst">$&#123;(validCount / (_cache.length + <span class="number">1</span>) * <span class="number">100</span>).toStringAsFixed(<span class="number">1</span>)&#125;</span>%&#x27;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 取消所有请求</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> cancelAllRequests() &#123;</span><br><span class="line">    _dio.close(force: <span class="keyword">true</span>);</span><br><span class="line">    _pendingRequests.clear();</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🚫 取消所有网络请求&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存项数据结构</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheItem</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">dynamic</span> data;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">DateTime</span> expireTime;</span><br><span class="line">  </span><br><span class="line">  CacheItem(&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.data,</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.expireTime,</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">bool</span> <span class="keyword">get</span> isExpired =&gt; <span class="built_in">DateTime</span>.now().isAfter(expireTime);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HTTP异常类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpException</span> <span class="keyword">implements</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> message;</span><br><span class="line">  </span><br><span class="line">  HttpException(<span class="keyword">this</span>.message);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> toString() =&gt; <span class="string">&#x27;HttpException: <span class="subst">$message</span>&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// API异常类（保持向后兼容）</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApiException</span> <span class="keyword">implements</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> message;</span><br><span class="line">  </span><br><span class="line">  ApiException(<span class="keyword">this</span>.message);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> toString() =&gt; <span class="string">&#x27;ApiException: <span class="subst">$message</span>&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-构建优化"><a href="#4-构建优化" class="headerlink" title="4. 构建优化"></a>4. 构建优化</h3><h4 id="配置-build-gradle-优化编译速度"><a href="#配置-build-gradle-优化编译速度" class="headerlink" title="配置 build.gradle 优化编译速度"></a>配置 build.gradle 优化编译速度</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// android/app/build.gradle</span></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">33</span></span><br><span class="line">    </span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        <span class="keyword">sourceCompatibility</span> JavaVersion.VERSION_1_8</span><br><span class="line">        <span class="keyword">targetCompatibility</span> JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            <span class="comment">// 启用代码混淆</span></span><br><span class="line">            minifyEnabled <span class="keyword">true</span></span><br><span class="line">            <span class="comment">// 启用资源压缩</span></span><br><span class="line">            shrinkResources <span class="keyword">true</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">&#x27;proguard-android-optimize.txt&#x27;</span>), <span class="string">&#x27;proguard-rules.pro&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        debug &#123;</span><br><span class="line">            <span class="comment">// 调试版本优化</span></span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">            debuggable <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用-Flutter-性能分析工具"><a href="#使用-Flutter-性能分析工具" class="headerlink" title="使用 Flutter 性能分析工具"></a>使用 Flutter 性能分析工具</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🔍 完整的性能监控工具</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceMonitor</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt;&gt; _buildTimes = &#123;&#125;;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">int</span>&gt; _buildCounts = &#123;&#125;;</span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">bool</span> _isProfilingEnabled = <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">static</span> Timer? _reportTimer;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 启动性能分析</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> startProfiling(&#123;</span><br><span class="line">    <span class="built_in">bool</span> enableDebugPaint = <span class="keyword">true</span>,</span><br><span class="line">    <span class="built_in">bool</span> enableRepaintRainbow = <span class="keyword">true</span>,</span><br><span class="line">    <span class="built_in">bool</span> enableLayerBorders = <span class="keyword">false</span>,</span><br><span class="line">    <span class="built_in">Duration</span> reportInterval = <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">30</span>),</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🔍 启动性能分析...&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    _isProfilingEnabled = <span class="keyword">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 启用调试工具</span></span><br><span class="line">    <span class="keyword">if</span> (enableDebugPaint) &#123;</span><br><span class="line">      debugPaintSizeEnabled = <span class="keyword">true</span>;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 启用Widget边界显示&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (enableRepaintRainbow) &#123;</span><br><span class="line">      debugRepaintRainbowEnabled = <span class="keyword">true</span>;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 启用重绘彩虹效果&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (enableLayerBorders) &#123;</span><br><span class="line">      debugPaintLayerBordersEnabled = <span class="keyword">true</span>;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 启用图层边界显示&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 启动定期报告</span></span><br><span class="line">    _reportTimer = Timer.periodic(reportInterval, (timer) &#123;</span><br><span class="line">      _generatePerformanceReport();</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;✅ 性能分析已启动&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 停止性能分析</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> stopProfiling() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🛑 停止性能分析...&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    _isProfilingEnabled = <span class="keyword">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 关闭调试工具</span></span><br><span class="line">    debugPaintSizeEnabled = <span class="keyword">false</span>;</span><br><span class="line">    debugRepaintRainbowEnabled = <span class="keyword">false</span>;</span><br><span class="line">    debugPaintLayerBordersEnabled = <span class="keyword">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 停止定期报告</span></span><br><span class="line">    _reportTimer?.cancel();</span><br><span class="line">    _reportTimer = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成最终报告</span></span><br><span class="line">    _generatePerformanceReport();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;✅ 性能分析已停止&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 测量Widget构建时间</span></span><br><span class="line">  <span class="keyword">static</span> T measureWidgetBuild&lt;T&gt;(</span><br><span class="line">    <span class="built_in">String</span> widgetName,</span><br><span class="line">    T <span class="built_in">Function</span>() buildFunction, &#123;</span><br><span class="line">    <span class="built_in">bool</span> logIndividualBuilds = <span class="keyword">false</span>,</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_isProfilingEnabled) &#123;</span><br><span class="line">      <span class="keyword">return</span> buildFunction();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> stopwatch = <span class="built_in">Stopwatch</span>()..start();</span><br><span class="line">    <span class="keyword">final</span> result = buildFunction();</span><br><span class="line">    stopwatch.stop();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> buildTime = stopwatch.elapsedMilliseconds;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 记录构建时间</span></span><br><span class="line">    _buildTimes.putIfAbsent(widgetName, () =&gt; []).add(buildTime);</span><br><span class="line">    _buildCounts[widgetName] = (_buildCounts[widgetName] ?? <span class="number">0</span>) + <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (logIndividualBuilds) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;🏗️ Widget &quot;<span class="subst">$widgetName</span>&quot; 构建时间: <span class="subst">$&#123;buildTime&#125;</span>ms&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果构建时间过长，发出警告</span></span><br><span class="line">    <span class="keyword">if</span> (buildTime &gt; <span class="number">16</span>) &#123; <span class="comment">// 超过一帧的时间</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;⚠️ 警告: Widget &quot;<span class="subst">$widgetName</span>&quot; 构建时间过长: <span class="subst">$&#123;buildTime&#125;</span>ms&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 测量异步操作性能</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;T&gt; measureAsyncOperation&lt;T&gt;(</span><br><span class="line">    <span class="built_in">String</span> operationName,</span><br><span class="line">    Future&lt;T&gt; <span class="built_in">Function</span>() operation,</span><br><span class="line">  ) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_isProfilingEnabled) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> operation();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> stopwatch = <span class="built_in">Stopwatch</span>()..start();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> result = <span class="keyword">await</span> operation();</span><br><span class="line">      stopwatch.stop();</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;⚡ 异步操作 &quot;<span class="subst">$operationName</span>&quot; 完成时间: <span class="subst">$&#123;stopwatch.elapsedMilliseconds&#125;</span>ms&#x27;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      stopwatch.stop();</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;❌ 异步操作 &quot;<span class="subst">$operationName</span>&quot; 失败，耗时: <span class="subst">$&#123;stopwatch.elapsedMilliseconds&#125;</span>ms&#x27;</span>);</span><br><span class="line">      <span class="keyword">rethrow</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 监控帧率</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> startFrameRateMonitoring() &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_isProfilingEnabled) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    WidgetsBinding.instance.addTimingsCallback((timings) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">final</span> timing <span class="keyword">in</span> timings) &#123;</span><br><span class="line">        <span class="keyword">final</span> frameDuration = timing.totalSpan.inMilliseconds;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (frameDuration &gt; <span class="number">16</span>) &#123; <span class="comment">// 超过60fps</span></span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;🎯 帧率警告: 帧渲染时间 <span class="subst">$&#123;frameDuration&#125;</span>ms (目标: &lt;16ms)&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 详细的帧时间分析</span></span><br><span class="line">        <span class="keyword">if</span> (frameDuration &gt; <span class="number">32</span>) &#123; <span class="comment">// 严重的帧率问题</span></span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;🚨 严重帧率问题:&#x27;</span>);</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;  - 总时间: <span class="subst">$&#123;frameDuration&#125;</span>ms&#x27;</span>);</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;  - 构建时间: <span class="subst">$&#123;timing.buildDuration.inMilliseconds&#125;</span>ms&#x27;</span>);</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;  - 光栅化时间: <span class="subst">$&#123;timing.rasterDuration.inMilliseconds&#125;</span>ms&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;📊 帧率监控已启动&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 生成性能报告</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> _generatePerformanceReport() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_buildTimes.isEmpty) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;📊 性能报告: 暂无数据&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n📊 ===== 性能分析报告 =====&#x27;</span>);</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;📅 报告时间: <span class="subst">$&#123;DateTime.now()&#125;</span>&#x27;</span>);</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🏗️ Widget构建性能:&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> sortedWidgets = _buildTimes.entries.toList()</span><br><span class="line">      ..sort((a, b) =&gt; _getAverageTime(b.value).compareTo(_getAverageTime(a.value)));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">final</span> entry <span class="keyword">in</span> sortedWidgets.take(<span class="number">10</span>)) &#123; <span class="comment">// 显示前10个最慢的Widget</span></span><br><span class="line">      <span class="keyword">final</span> widgetName = entry.key;</span><br><span class="line">      <span class="keyword">final</span> times = entry.value;</span><br><span class="line">      <span class="keyword">final</span> count = _buildCounts[widgetName] ?? <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">final</span> avgTime = _getAverageTime(times);</span><br><span class="line">      <span class="keyword">final</span> maxTime = times.reduce((a, b) =&gt; a &gt; b ? a : b);</span><br><span class="line">      <span class="keyword">final</span> minTime = times.reduce((a, b) =&gt; a &lt; b ? a : b);</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;  📦 <span class="subst">$widgetName</span>:&#x27;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;    - 构建次数: <span class="subst">$count</span>&#x27;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;    - 平均时间: <span class="subst">$&#123;avgTime.toStringAsFixed(<span class="number">1</span>)&#125;</span>ms&#x27;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;    - 最大时间: <span class="subst">$&#123;maxTime&#125;</span>ms&#x27;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;    - 最小时间: <span class="subst">$&#123;minTime&#125;</span>ms&#x27;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (avgTime &gt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;    ⚠️ 建议优化此Widget&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n🎯 性能建议:&#x27;</span>);</span><br><span class="line">    _generatePerformanceSuggestions();</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;===========================\n&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 计算平均时间</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">double</span> _getAverageTime(<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; times) &#123;</span><br><span class="line">    <span class="keyword">if</span> (times.isEmpty) <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">return</span> times.reduce((a, b) =&gt; a + b) / times.length;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 生成性能建议</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> _generatePerformanceSuggestions() &#123;</span><br><span class="line">    <span class="keyword">final</span> suggestions = &lt;<span class="built_in">String</span>&gt;[];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分析慢速Widget</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">final</span> entry <span class="keyword">in</span> _buildTimes.entries) &#123;</span><br><span class="line">      <span class="keyword">final</span> avgTime = _getAverageTime(entry.value);</span><br><span class="line">      <span class="keyword">if</span> (avgTime &gt; <span class="number">16</span>) &#123;</span><br><span class="line">        suggestions.add(<span class="string">&#x27;优化 &quot;<span class="subst">$&#123;entry.key&#125;</span>&quot; Widget的构建性能&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分析频繁重建的Widget</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">final</span> entry <span class="keyword">in</span> _buildCounts.entries) &#123;</span><br><span class="line">      <span class="keyword">if</span> (entry.value &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        suggestions.add(<span class="string">&#x27;减少 &quot;<span class="subst">$&#123;entry.key&#125;</span>&quot; Widget的重建频率&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (suggestions.isEmpty) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 当前性能表现良好，无需特别优化&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; suggestions.length; i++) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;<span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>. <span class="subst">$&#123;suggestions[i]&#125;</span>&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 清除性能数据</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> clearData() &#123;</span><br><span class="line">    _buildTimes.clear();</span><br><span class="line">    _buildCounts.clear();</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;🧹 性能数据已清除&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 main.dart 中使用性能监控</span></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="comment">// 只在 Debug 模式下启用性能监控</span></span><br><span class="line">  <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">    <span class="comment">// 启动完整的性能分析</span></span><br><span class="line">    PerformanceMonitor.startProfiling(</span><br><span class="line">      enableDebugPaint: <span class="keyword">true</span>,</span><br><span class="line">      enableRepaintRainbow: <span class="keyword">false</span>, <span class="comment">// 根据需要开启</span></span><br><span class="line">      enableLayerBorders: <span class="keyword">false</span>,</span><br><span class="line">      reportInterval: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">30</span>),</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 启动帧率监控</span></span><br><span class="line">    PerformanceMonitor.startFrameRateMonitoring();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 启用性能覆盖层</span></span><br><span class="line">    debugProfileBuildsEnabled = <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 性能监控Widget装饰器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> name;</span><br><span class="line">  <span class="keyword">final</span> Widget child;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> enableProfiling;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> PerformanceWidget(&#123;</span><br><span class="line">    Key? key,</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.name,</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.child,</span><br><span class="line">    <span class="keyword">this</span>.enableProfiling = <span class="keyword">true</span>,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!enableProfiling) &#123;</span><br><span class="line">      <span class="keyword">return</span> child;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> PerformanceMonitor.measureWidgetBuild(</span><br><span class="line">      name,</span><br><span class="line">      () =&gt; child,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-测试策略"><a href="#5-测试策略" class="headerlink" title="5. 测试策略"></a>5. 测试策略</h3><h4 id="实现全面的测试覆盖"><a href="#实现全面的测试覆盖" class="headerlink" title="实现全面的测试覆盖"></a>实现全面的测试覆盖</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test/widget_test.dart</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_test/flutter_test.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:mockito/mockito.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:mockito/annotations.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🧪 生成Mock类</span></span><br><span class="line"><span class="meta">@GenerateMocks</span>([ApiService, DatabaseService])</span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  group(<span class="string">&#x27;Widget Tests&#x27;</span>, () &#123;</span><br><span class="line">    <span class="keyword">late</span> MockApiService mockApiService;</span><br><span class="line">    <span class="keyword">late</span> MockDatabaseService mockDatabaseService;</span><br><span class="line">    </span><br><span class="line">    setUp(() &#123;</span><br><span class="line">      <span class="comment">// 初始化Mock对象</span></span><br><span class="line">      mockApiService = MockApiService();</span><br><span class="line">      mockDatabaseService = MockDatabaseService();</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    testWidgets(<span class="string">&#x27;Counter increments smoke test&#x27;</span>, (WidgetTester tester) <span class="keyword">async</span> &#123;</span><br><span class="line">      <span class="comment">// 构建应用并触发一帧</span></span><br><span class="line">      <span class="keyword">await</span> tester.pumpWidget(<span class="keyword">const</span> MyApp());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 验证计数器从0开始</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;0&#x27;</span>), findsOneWidget);</span><br><span class="line">      expect(find.text(<span class="string">&#x27;1&#x27;</span>), findsNothing);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 点击&#x27;+&#x27;图标并触发一帧</span></span><br><span class="line">      <span class="keyword">await</span> tester.tap(find.byIcon(Icons.add));</span><br><span class="line">      <span class="keyword">await</span> tester.pump();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 验证计数器已增加</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;0&#x27;</span>), findsNothing);</span><br><span class="line">      expect(find.text(<span class="string">&#x27;1&#x27;</span>), findsOneWidget);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    testWidgets(<span class="string">&#x27;用户列表加载测试&#x27;</span>, (WidgetTester tester) <span class="keyword">async</span> &#123;</span><br><span class="line">      <span class="comment">// 🎭 模拟API响应</span></span><br><span class="line">      when(mockApiService.getUsers()).thenAnswer((_) <span class="keyword">async</span> =&gt; [</span><br><span class="line">        User(id: <span class="number">1</span>, name: <span class="string">&#x27;张三&#x27;</span>, email: <span class="string">&#x27;zhangsan@example.com&#x27;</span>),</span><br><span class="line">        User(id: <span class="number">2</span>, name: <span class="string">&#x27;李四&#x27;</span>, email: <span class="string">&#x27;lisi@example.com&#x27;</span>),</span><br><span class="line">      ]);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 构建用户列表页面</span></span><br><span class="line">      <span class="keyword">await</span> tester.pumpWidget(</span><br><span class="line">        MaterialApp(</span><br><span class="line">          home: UserListPage(apiService: mockApiService),</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证加载状态</span></span><br><span class="line">      expect(find.byType(CircularProgressIndicator), findsOneWidget);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 等待异步操作完成</span></span><br><span class="line">      <span class="keyword">await</span> tester.pumpAndSettle();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证用户数据显示</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;张三&#x27;</span>), findsOneWidget);</span><br><span class="line">      expect(find.text(<span class="string">&#x27;李四&#x27;</span>), findsOneWidget);</span><br><span class="line">      expect(find.byType(CircularProgressIndicator), findsNothing);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证API调用</span></span><br><span class="line">      verify(mockApiService.getUsers()).called(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    testWidgets(<span class="string">&#x27;表单验证测试&#x27;</span>, (WidgetTester tester) <span class="keyword">async</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> tester.pumpWidget(</span><br><span class="line">        MaterialApp(</span><br><span class="line">          home: Scaffold(</span><br><span class="line">            body: LoginForm(),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 查找表单字段</span></span><br><span class="line">      <span class="keyword">final</span> emailField = find.byKey(<span class="keyword">const</span> Key(<span class="string">&#x27;email_field&#x27;</span>));</span><br><span class="line">      <span class="keyword">final</span> passwordField = find.byKey(<span class="keyword">const</span> Key(<span class="string">&#x27;password_field&#x27;</span>));</span><br><span class="line">      <span class="keyword">final</span> submitButton = find.byKey(<span class="keyword">const</span> Key(<span class="string">&#x27;submit_button&#x27;</span>));</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 测试空表单提交</span></span><br><span class="line">      <span class="keyword">await</span> tester.tap(submitButton);</span><br><span class="line">      <span class="keyword">await</span> tester.pump();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证错误消息</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;请输入邮箱&#x27;</span>), findsOneWidget);</span><br><span class="line">      expect(find.text(<span class="string">&#x27;请输入密码&#x27;</span>), findsOneWidget);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 输入无效邮箱</span></span><br><span class="line">      <span class="keyword">await</span> tester.enterText(emailField, <span class="string">&#x27;invalid-email&#x27;</span>);</span><br><span class="line">      <span class="keyword">await</span> tester.tap(submitButton);</span><br><span class="line">      <span class="keyword">await</span> tester.pump();</span><br><span class="line">      </span><br><span class="line">      expect(find.text(<span class="string">&#x27;请输入有效的邮箱地址&#x27;</span>), findsOneWidget);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 输入有效数据</span></span><br><span class="line">      <span class="keyword">await</span> tester.enterText(emailField, <span class="string">&#x27;test@example.com&#x27;</span>);</span><br><span class="line">      <span class="keyword">await</span> tester.enterText(passwordField, <span class="string">&#x27;password123&#x27;</span>);</span><br><span class="line">      <span class="keyword">await</span> tester.tap(submitButton);</span><br><span class="line">      <span class="keyword">await</span> tester.pump();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证错误消息消失</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;请输入邮箱&#x27;</span>), findsNothing);</span><br><span class="line">      expect(find.text(<span class="string">&#x27;请输入密码&#x27;</span>), findsNothing);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    testWidgets(<span class="string">&#x27;滚动性能测试&#x27;</span>, (WidgetTester tester) <span class="keyword">async</span> &#123;</span><br><span class="line">      <span class="comment">// 创建大量数据</span></span><br><span class="line">      <span class="keyword">final</span> items = <span class="built_in">List</span>.generate(<span class="number">1000</span>, (index) =&gt; <span class="string">&#x27;Item <span class="subst">$index</span>&#x27;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">await</span> tester.pumpWidget(</span><br><span class="line">        MaterialApp(</span><br><span class="line">          home: Scaffold(</span><br><span class="line">            body: ListView.builder(</span><br><span class="line">              itemCount: items.length,</span><br><span class="line">              itemBuilder: (context, index) &#123;</span><br><span class="line">                <span class="keyword">return</span> ListTile(</span><br><span class="line">                  title: Text(items[index]),</span><br><span class="line">                  key: Key(<span class="string">&#x27;item_<span class="subst">$index</span>&#x27;</span>),</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证初始状态</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;Item 0&#x27;</span>), findsOneWidget);</span><br><span class="line">      expect(find.text(<span class="string">&#x27;Item 999&#x27;</span>), findsNothing);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 测试滚动性能</span></span><br><span class="line">      <span class="keyword">final</span> stopwatch = <span class="built_in">Stopwatch</span>()..start();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 快速滚动到底部</span></span><br><span class="line">      <span class="keyword">await</span> tester.fling(</span><br><span class="line">        find.byType(ListView),</span><br><span class="line">        <span class="keyword">const</span> Offset(<span class="number">0</span>, <span class="number">-5000</span>),</span><br><span class="line">        <span class="number">1000</span>,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">await</span> tester.pumpAndSettle();</span><br><span class="line">      </span><br><span class="line">      stopwatch.stop();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证滚动完成</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;Item 999&#x27;</span>), findsOneWidget);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证滚动性能（应该在合理时间内完成）</span></span><br><span class="line">      expect(stopwatch.elapsedMilliseconds, lessThan(<span class="number">2000</span>));</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;📊 滚动性能测试: <span class="subst">$&#123;stopwatch.elapsedMilliseconds&#125;</span>ms&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    testWidgets(<span class="string">&#x27;网络错误处理测试&#x27;</span>, (WidgetTester tester) <span class="keyword">async</span> &#123;</span><br><span class="line">      <span class="comment">// 🚨 模拟网络错误</span></span><br><span class="line">      when(mockApiService.getUsers())</span><br><span class="line">          .thenThrow(Exception(<span class="string">&#x27;网络连接失败&#x27;</span>));</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">await</span> tester.pumpWidget(</span><br><span class="line">        MaterialApp(</span><br><span class="line">          home: UserListPage(apiService: mockApiService),</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 等待错误处理</span></span><br><span class="line">      <span class="keyword">await</span> tester.pumpAndSettle();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证错误消息显示</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;网络连接失败&#x27;</span>), findsOneWidget);</span><br><span class="line">      expect(find.byIcon(Icons.refresh), findsOneWidget);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 测试重试功能</span></span><br><span class="line">      when(mockApiService.getUsers()).thenAnswer((_) <span class="keyword">async</span> =&gt; [</span><br><span class="line">        User(id: <span class="number">1</span>, name: <span class="string">&#x27;张三&#x27;</span>, email: <span class="string">&#x27;zhangsan@example.com&#x27;</span>),</span><br><span class="line">      ]);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">await</span> tester.tap(find.byIcon(Icons.refresh));</span><br><span class="line">      <span class="keyword">await</span> tester.pumpAndSettle();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证重试后数据加载成功</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;张三&#x27;</span>), findsOneWidget);</span><br><span class="line">      expect(find.text(<span class="string">&#x27;网络连接失败&#x27;</span>), findsNothing);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  group(<span class="string">&#x27;单元测试&#x27;</span>, () &#123;</span><br><span class="line">    test(<span class="string">&#x27;用户模型序列化测试&#x27;</span>, () &#123;</span><br><span class="line">      <span class="comment">// 测试数据</span></span><br><span class="line">      <span class="keyword">final</span> userData = &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;zhangsan@example.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;created_at&#x27;</span>: <span class="string">&#x27;2023-01-01T00:00:00Z&#x27;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 从JSON创建用户对象</span></span><br><span class="line">      <span class="keyword">final</span> user = User.fromJson(userData);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 验证属性</span></span><br><span class="line">      expect(user.id, equals(<span class="number">1</span>));</span><br><span class="line">      expect(user.name, equals(<span class="string">&#x27;张三&#x27;</span>));</span><br><span class="line">      expect(user.email, equals(<span class="string">&#x27;zhangsan@example.com&#x27;</span>));</span><br><span class="line">      expect(user.createdAt, isA&lt;<span class="built_in">DateTime</span>&gt;());</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 测试序列化</span></span><br><span class="line">      <span class="keyword">final</span> json = user.toJson();</span><br><span class="line">      expect(json[<span class="string">&#x27;id&#x27;</span>], equals(<span class="number">1</span>));</span><br><span class="line">      expect(json[<span class="string">&#x27;name&#x27;</span>], equals(<span class="string">&#x27;张三&#x27;</span>));</span><br><span class="line">      expect(json[<span class="string">&#x27;email&#x27;</span>], equals(<span class="string">&#x27;zhangsan@example.com&#x27;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    test(<span class="string">&#x27;验证工具类测试&#x27;</span>, () &#123;</span><br><span class="line">      <span class="comment">// 测试邮箱验证</span></span><br><span class="line">      expect(ValidationUtils.isValidEmail(<span class="string">&#x27;test@example.com&#x27;</span>), isTrue);</span><br><span class="line">      expect(ValidationUtils.isValidEmail(<span class="string">&#x27;invalid-email&#x27;</span>), isFalse);</span><br><span class="line">      expect(ValidationUtils.isValidEmail(<span class="string">&#x27;&#x27;</span>), isFalse);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 测试密码强度</span></span><br><span class="line">      expect(ValidationUtils.isStrongPassword(<span class="string">&#x27;password123&#x27;</span>), isFalse);</span><br><span class="line">      expect(ValidationUtils.isStrongPassword(<span class="string">&#x27;Password123!&#x27;</span>), isTrue);</span><br><span class="line">      expect(ValidationUtils.isStrongPassword(<span class="string">&#x27;123&#x27;</span>), isFalse);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 测试手机号验证</span></span><br><span class="line">      expect(ValidationUtils.isValidPhone(<span class="string">&#x27;13800138000&#x27;</span>), isTrue);</span><br><span class="line">      expect(ValidationUtils.isValidPhone(<span class="string">&#x27;1380013800&#x27;</span>), isFalse);</span><br><span class="line">      expect(ValidationUtils.isValidPhone(<span class="string">&#x27;abc&#x27;</span>), isFalse);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    test(<span class="string">&#x27;缓存管理测试&#x27;</span>, () <span class="keyword">async</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> cacheManager = CacheManager();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 测试缓存存储</span></span><br><span class="line">      <span class="keyword">await</span> cacheManager.put(<span class="string">&#x27;test_key&#x27;</span>, <span class="string">&#x27;test_value&#x27;</span>);</span><br><span class="line">      <span class="keyword">final</span> value = <span class="keyword">await</span> cacheManager.<span class="keyword">get</span>(<span class="string">&#x27;test_key&#x27;</span>);</span><br><span class="line">      expect(value, equals(<span class="string">&#x27;test_value&#x27;</span>));</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 测试缓存过期</span></span><br><span class="line">      <span class="keyword">await</span> cacheManager.put(</span><br><span class="line">        <span class="string">&#x27;expire_key&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;expire_value&#x27;</span>,</span><br><span class="line">        duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">100</span>),</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 立即获取应该有值</span></span><br><span class="line">      <span class="keyword">final</span> immediateValue = <span class="keyword">await</span> cacheManager.<span class="keyword">get</span>(<span class="string">&#x27;expire_key&#x27;</span>);</span><br><span class="line">      expect(immediateValue, equals(<span class="string">&#x27;expire_value&#x27;</span>));</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 等待过期</span></span><br><span class="line">      <span class="keyword">await</span> Future.delayed(<span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">150</span>));</span><br><span class="line">      <span class="keyword">final</span> expiredValue = <span class="keyword">await</span> cacheManager.<span class="keyword">get</span>(<span class="string">&#x27;expire_key&#x27;</span>);</span><br><span class="line">      expect(expiredValue, isNull);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 测试缓存清除</span></span><br><span class="line">      <span class="keyword">await</span> cacheManager.put(<span class="string">&#x27;clear_key&#x27;</span>, <span class="string">&#x27;clear_value&#x27;</span>);</span><br><span class="line">      <span class="keyword">await</span> cacheManager.clear();</span><br><span class="line">      <span class="keyword">final</span> clearedValue = <span class="keyword">await</span> cacheManager.<span class="keyword">get</span>(<span class="string">&#x27;clear_key&#x27;</span>);</span><br><span class="line">      expect(clearedValue, isNull);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  group(<span class="string">&#x27;集成测试&#x27;</span>, () &#123;</span><br><span class="line">    testWidgets(<span class="string">&#x27;完整用户流程测试&#x27;</span>, (WidgetTester tester) <span class="keyword">async</span> &#123;</span><br><span class="line">      <span class="comment">// 🎬 模拟完整的用户操作流程</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 1. 启动应用</span></span><br><span class="line">      <span class="keyword">await</span> tester.pumpWidget(MyApp());</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 2. 导航到登录页面</span></span><br><span class="line">      <span class="keyword">await</span> tester.tap(find.text(<span class="string">&#x27;登录&#x27;</span>));</span><br><span class="line">      <span class="keyword">await</span> tester.pumpAndSettle();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 3. 输入登录信息</span></span><br><span class="line">      <span class="keyword">await</span> tester.enterText(</span><br><span class="line">        find.byKey(<span class="keyword">const</span> Key(<span class="string">&#x27;email_field&#x27;</span>)),</span><br><span class="line">        <span class="string">&#x27;test@example.com&#x27;</span>,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">await</span> tester.enterText(</span><br><span class="line">        find.byKey(<span class="keyword">const</span> Key(<span class="string">&#x27;password_field&#x27;</span>)),</span><br><span class="line">        <span class="string">&#x27;password123&#x27;</span>,</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 4. 提交登录</span></span><br><span class="line">      <span class="keyword">await</span> tester.tap(find.byKey(<span class="keyword">const</span> Key(<span class="string">&#x27;login_button&#x27;</span>)));</span><br><span class="line">      <span class="keyword">await</span> tester.pumpAndSettle();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 5. 验证导航到主页</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;欢迎回来&#x27;</span>), findsOneWidget);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 6. 测试主要功能</span></span><br><span class="line">      <span class="keyword">await</span> tester.tap(find.text(<span class="string">&#x27;用户列表&#x27;</span>));</span><br><span class="line">      <span class="keyword">await</span> tester.pumpAndSettle();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 7. 验证数据加载</span></span><br><span class="line">      expect(find.byType(ListView), findsOneWidget);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 8. 测试搜索功能</span></span><br><span class="line">      <span class="keyword">await</span> tester.enterText(</span><br><span class="line">        find.byKey(<span class="keyword">const</span> Key(<span class="string">&#x27;search_field&#x27;</span>)),</span><br><span class="line">        <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">await</span> tester.pump(<span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">500</span>));</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 9. 验证搜索结果</span></span><br><span class="line">      expect(find.text(<span class="string">&#x27;张三&#x27;</span>), findsOneWidget);</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;✅ 完整用户流程测试通过&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🛠️ 测试工具类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestUtils</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 创建测试用的MaterialApp</span></span><br><span class="line">  <span class="keyword">static</span> Widget createTestApp(Widget child) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      home: Scaffold(body: child),</span><br><span class="line">      theme: ThemeData.light(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待动画完成</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="keyword">void</span>&gt; waitForAnimation(</span><br><span class="line">    WidgetTester tester, &#123;</span><br><span class="line">    <span class="built_in">Duration</span> timeout = <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">5</span>),</span><br><span class="line">  &#125;) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> tester.pumpAndSettle(<span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">100</span>), timeout);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 模拟网络延迟</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="keyword">void</span>&gt; simulateNetworkDelay([</span><br><span class="line">    <span class="built_in">Duration</span> delay = <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">500</span>),</span><br><span class="line">  ]) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> Future.delayed(delay);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 验证Widget存在且可见</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> expectWidgetVisible(Finder finder) &#123;</span><br><span class="line">    expect(finder, findsOneWidget);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 验证Widget不存在</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> expectWidgetNotFound(Finder finder) &#123;</span><br><span class="line">    expect(finder, findsNothing);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 📊 性能测试工具</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceTestUtils</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 测量Widget构建时间</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="built_in">Duration</span>&gt; measureBuildTime(</span><br><span class="line">    WidgetTester tester,</span><br><span class="line">    Widget widget,</span><br><span class="line">  ) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> stopwatch = <span class="built_in">Stopwatch</span>()..start();</span><br><span class="line">    <span class="keyword">await</span> tester.pumpWidget(widget);</span><br><span class="line">    stopwatch.stop();</span><br><span class="line">    <span class="keyword">return</span> stopwatch.elapsed;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 测量滚动性能</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="built_in">Duration</span>&gt; measureScrollPerformance(</span><br><span class="line">    WidgetTester tester,</span><br><span class="line">    Finder scrollable,</span><br><span class="line">    Offset offset,</span><br><span class="line">  ) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> stopwatch = <span class="built_in">Stopwatch</span>()..start();</span><br><span class="line">    <span class="keyword">await</span> tester.fling(scrollable, offset, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">await</span> tester.pumpAndSettle();</span><br><span class="line">    stopwatch.stop();</span><br><span class="line">    <span class="keyword">return</span> stopwatch.elapsed;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 验证性能指标</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> assertPerformance(</span><br><span class="line">    <span class="built_in">Duration</span> actual,</span><br><span class="line">    <span class="built_in">Duration</span> expected, &#123;</span><br><span class="line">    <span class="built_in">String?</span> message,</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    expect(</span><br><span class="line">      actual.inMilliseconds,</span><br><span class="line">      lessThanOrEqualTo(expected.inMilliseconds),</span><br><span class="line">      reason: message ?? <span class="string">&#x27;性能不符合预期: <span class="subst">$&#123;actual.inMilliseconds&#125;</span>ms &gt; <span class="subst">$&#123;expected.inMilliseconds&#125;</span>ms&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过合理使用 Flutter 提供的调试工具，如 <code>debugPaintSizeEnabled</code> 和 <code>debugRepaintRainbowEnabled</code>，开发者可以更好地理解应用的布局和性能特征。结合本文提到的开发技巧和优化策略，可以显著提升 Flutter 应用的性能和用户体验。</p>
<p>记住，性能优化是一个持续的过程，需要在开发过程中不断监控和调整。定期使用调试工具分析应用性能，及时发现和解决潜在问题，是保持应用高性能的关键。</p>
<h3 id="快速参考"><a href="#快速参考" class="headerlink" title="快速参考"></a>快速参考</h3><h4 id="调试工具快速启用"><a href="#调试工具快速启用" class="headerlink" title="调试工具快速启用"></a>调试工具快速启用</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 main.dart 中快速启用所有调试工具</span></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">if</span> (kDebugMode) &#123;</span><br><span class="line">    debugPaintSizeEnabled = <span class="keyword">true</span>;        <span class="comment">// 显示布局边界</span></span><br><span class="line">    debugRepaintRainbowEnabled = <span class="keyword">true</span>;   <span class="comment">// 显示重绘彩虹</span></span><br><span class="line">    debugPaintLayerBordersEnabled = <span class="keyword">true</span>; <span class="comment">// 显示图层边界</span></span><br><span class="line">  &#125;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="性能优化检查清单"><a href="#性能优化检查清单" class="headerlink" title="性能优化检查清单"></a>性能优化检查清单</h4><ul>
<li><input disabled="" type="checkbox"> 使用 const 构造函数</li>
<li><input disabled="" type="checkbox"> 避免在 build 方法中创建 Widget</li>
<li><input disabled="" type="checkbox"> 合理使用 setState 范围</li>
<li><input disabled="" type="checkbox"> 使用 ListView.builder 处理大列表</li>
<li><input disabled="" type="checkbox"> 实现图片缓存和懒加载</li>
<li><input disabled="" type="checkbox"> 使用 RepaintBoundary 优化重绘</li>
<li><input disabled="" type="checkbox"> 正确释放资源和控制器</li>
<li><input disabled="" type="checkbox"> 实现网络请求缓存</li>
<li><input disabled="" type="checkbox"> 编写单元测试和 Widget 测试</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Flutter/" rel="tag"># Flutter</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/04/15/Flutter%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%85%8D%E7%BD%AE/" rel="prev" title="Flutter介绍与配置">
                  <i class="fa fa-chevron-left"></i> Flutter介绍与配置
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/04/16/Flutter%E4%B8%8E%E5%8E%9F%E7%94%9F%E4%BA%A4%E4%BA%92/" rel="next" title="Flutter与原生交互">
                  Flutter与原生交互 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2016 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">拿根针尖对麦芒</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
